here<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit√© Rapide ‚Äî Boutique</title>

<!-- CSP souple pour GitHub Pages + Google Sheets + CountAPI -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data:; img-src 'self' https: data: blob:; style-src 'self' 'unsafe-inline' https:; script-src 'self' 'unsafe-inline' https:; connect-src 'self' https:;" />

<style>
:root{
  --bg1:#0f172a; --bg2:#1e293b;
  --brand:#10b981; --accent:#f59e0b; --danger:#ef4444; --info:#3b82f6;
  --text:#e5e7eb; --muted:#94a3b8; --card:#111827cc;
  --shadow:0 10px 30px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
  background: radial-gradient(1200px 800px at 10% 10%, #0b1225 0%, #0f172a 40%, #0a0f1f 100%);
  overflow-x:hidden;
}
.bg-anim{position:fixed; inset:-20vmax; z-index:-1; filter:blur(80px) saturate(130%); opacity:.45;
  background:conic-gradient(from 180deg,#00c2ff,#7c3aed,#10b981,#f59e0b,#00c2ff); animation:spin 28s linear infinite}
@keyframes spin{to{transform:rotate(1turn)}}
header{position:sticky; top:0; z-index:50; backdrop-filter:saturate(140%) blur(8px);
  background:linear-gradient(180deg, rgba(2,6,23,.85), rgba(2,6,23,.55));
  border-bottom:1px solid rgba(148,163,184,.15)}
.wrap{max-width:1150px; margin:0 auto; padding:16px 20px}
.row{display:flex; gap:14px; align-items:center; flex-wrap:wrap}
.brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px}
.logo{width:38px; height:38px; border-radius:12px; background:linear-gradient(135deg,var(--brand),var(--info)); display:grid; place-items:center; box-shadow:var(--shadow); font-weight:900; color:#fff}
.promo{background:linear-gradient(90deg, rgba(16,185,129,.15), rgba(59,130,246,.15)); border:1px solid rgba(16,185,129,.25); color:#d1fae5;
  padding:10px 14px; border-radius:12px; font-weight:600; display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap}
.badges{display:flex; gap:10px; flex-wrap:wrap}
.badge{background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); border:1px solid rgba(148,163,184,.18);
  padding:8px 12px; border-radius:999px; font-weight:600; display:flex; align-items:center; gap:8px; color:#e2e8f0}

main{max-width:1150px; margin:24px auto; padding:0 20px 80px}
.controls{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:10px 0 14px}
.search{flex:1; min-width:220px; padding:10px 12px; border-radius:12px; border:1px solid rgba(148,163,184,.25); background:rgba(255,255,255,.06); color:#fff}
.filters{display:flex; gap:8px; flex-wrap:wrap}
.chip{padding:8px 12px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(148,163,184,.18); cursor:pointer; font-weight:700}
.chip.active{background:linear-gradient(90deg, rgba(16,185,129,.25), rgba(59,130,246,.25)); border-color:#34d39977}

.cards{display:grid; grid-template-columns:repeat(auto-fit, minmax(240px, 1fr)); gap:16px}
.card{background:linear-gradient(180deg, rgba(17,24,39,.85), rgba(17,24,39,.65)); border:1px solid rgba(148,163,184,.18);
  border-radius:18px; overflow:hidden; box-shadow:var(--shadow); display:flex; flex-direction:column; min-height:100%}
.card img{width:100%; height:180px; object-fit:cover; background:#0b1020}
.card .p{padding:12px 14px}
.title{font-weight:800; font-size:1.05rem}
.muted{color:var(--muted); font-size:.92rem}
.price{display:flex; align-items:center; gap:10px; margin-top:6px}
.price .fc{font-weight:900; font-size:1.15rem}
.price .usd{color:#93c5fd; font-weight:700}
.cta{margin-top:10px; display:flex; gap:8px}
.btn{flex:1; display:inline-flex; justify-content:center; align-items:center; gap:8px; padding:10px 12px; border-radius:12px; border:1px solid transparent; cursor:pointer; font-weight:800; text-decoration:none}
.btn.whatsapp{background:#25D36622; border-color:#25D36655; color:#c3f9d7}
.btn.buy{background:#10b98122; border-color:#10b98166; color:#d1fae5}
.btn:hover{transform:translateY(-1px)}
.badge-timer{margin-left:auto; background:rgba(245,158,11,.18); border:1px solid #f59e0b55; color:#fde68a; padding:6px 10px; border-radius:999px; font-weight:800; font-size:.85rem}

.stats{display:flex; gap:12px; flex-wrap:wrap; margin:18px 0}
.stat{background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); border:1px solid rgba(148,163,184,.18); padding:10px 14px; border-radius:14px; font-weight:700}

.float{position:fixed; right:18px; bottom:18px; display:flex; flex-direction:column; gap:10px; z-index:60}
.float a{display:flex; align-items:center; gap:8px; padding:10px 12px; border-radius:999px; text-decoration:none; font-weight:800; box-shadow:var(--shadow)}
.float .w{background:#25D366; color:#06250f}
.float .t{background:#229ED9; color:#041e2a}

footer{max-width:1150px; margin:40px auto; padding:0 20px 60px; color:#cbd5e1}
.pay{display:flex; gap:10px; flex-wrap:wrap}
.pill{background:rgba(255,255,255,.07); border:1px solid rgba(148,163,184,.18); padding:8px 12px; border-radius:999px; font-weight:700}
details{background:rgba(255,255,255,.05); border:1px solid rgba(148,163,184,.18); padding:12px; border-radius:14px}
details summary{cursor:pointer; font-weight:900}

/* Modal g√©n√©rique */
.modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(2,6,23,.65); z-index:80; padding:20px}
.modal .box{max-width:520px; width:100%; background:linear-gradient(180deg, rgba(17,24,39,.96), rgba(17,24,39,.88)); border:1px solid rgba(148,163,184,.22); border-radius:18px; box-shadow:var(--shadow); padding:16px}
.modal .head{display:flex; align-items:center; justify-content:space-between; margin-bottom:10px}
.x{cursor:pointer; border:none; background:rgba(255,255,255,.06); color:#fff; padding:8px 10px; border-radius:10px; font-weight:800}
.input{width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(148,163,184,.25); background:rgba(255,255,255,.06); color:#fff}
.grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}

/* Galerie */
.gallery{display:grid; grid-template-columns:repeat(5, 1fr); gap:6px; margin-top:8px}
.gallery img{width:100%; height:64px; object-fit:cover; border-radius:10px; border:1px solid rgba(148,163,184,.2); cursor:pointer}

/* Gate (inscription) */
.gate{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(2,6,23,.85); z-index:90; padding:20px}
.gate .card{max-width:520px; width:100%; background:linear-gradient(180deg, rgba(17,24,39,.96), rgba(17,24,39,.88)); border:1px solid rgba(148,163,184,.22); border-radius:18px; box-shadow:var(--shadow); padding:18px}
</style>
</head>
<body>
<div class="bg-anim"></div>

<header>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <div class="brand">
        <div class="logo">UR</div>
        <div>
          <div style="font-size:1.05rem">Unit√© Rapide</div>
          <div class="muted" style="font-size:.85rem">Unit√©s ‚Ä¢ T√©l√©phones ‚Ä¢ V√™tements ‚Ä¢ Accessoires</div>
        </div>
      </div>
      <div class="badges">
        <div class="badge">üîí S√©curis√©</div>
        <div class="badge">üöö Livraison rapide</div>
        <div class="badge">‚≠ê Qualit√© garantie</div>
        <div class="badge">üïò 24/7</div>
        <div class="badge" id="visitsBadge">üëÅÔ∏è Visites : ‚Ä¶</div>
      </div>
    </div>
    <div class="promo" style="margin-top:12px">
      <div>üî• <strong>Promos</strong> cette semaine ‚Äî meilleurs prix garantis.</div>
      <div class="muted">WhatsApp : <strong>+243 990 564 877</strong> ‚Ä¢ Telegram : <strong>@cphkkk66</strong></div>
    </div>
  </div>
</header>

<main>
  <section class="stats">
    <div class="stat">üë§ Connect√© : <span id="clientName">‚Äî</span> (<span id="clientPhone">‚Äî</span>)</div>
    <div class="stat">üëÅÔ∏è Vues (appareil) : <span id="viewsLocal">0</span></div>
    <div class="stat">‚ù§Ô∏è J'aime : <span id="likesCount">0</span> <button id="likeBtn" class="chip" style="margin-left:8px">+ J'aime</button></div>
  </section>

  <section>
    <div class="controls">
      <input id="search" class="search" placeholder="Rechercher un produit‚Ä¶" />
      <div class="filters" id="filters"></div>
    </div>
    <div class="cards" id="cards">Chargement‚Ä¶</div>
  </section>

  <section style="margin-top:28px">
    <h2>Contact</h2>
    <div class="row">
      <a class="btn whatsapp" href="https://wa.me/243990564877" target="_blank">üì± WhatsApp</a>
      <a class="btn" style="background:#229ED922;border:1px solid #229ED955;color:#cfe9ff" href="https://t.me/cphkkk66" target="_blank">üí¨ Telegram</a>
    </div>
  </section>

  <section style="margin-top:28px">
    <h2>Modes de paiement</h2>
    <div class="pay">
      <span class="pill">üí≥ Airtel Money ‚Äî <strong>Mugisho St√©phane</strong> ‚Ä¢ <strong>+243 990 564 877</strong></span>
      <span class="pill">üì≤ M-Pesa (Vodacom)</span>
      <span class="pill">üü† Orange Money</span>
      <span class="pill">üü£ Afrimoney (Africell)</span>
      <span class="pill">üü° MoMo (MTN)</span>
    </div>
  </section>

  <section style="margin-top:28px">
    <details>
      <summary>üîß Param√®tres & S√©curit√© (infos client)</summary>
      <ul>
        <li>Ce site affiche seulement les <strong>produits et prix</strong>. Aucune donn√©e sensible n'est publique.</li>
        <li>Catalogue aliment√© par une feuille <strong>PUBLIC</strong> (lecture seule).</li>
        <li>Contacts officiels : WhatsApp <strong>+243 990 564 877</strong>, Telegram <strong>@cphkkk66</strong>, Airtel Money <strong>Mugisho St√©phane</strong>.</li>
      </ul>
    </details>
  </section>
</main>

<!-- Boutons flottants -->
<div class="float">
  <a class="w" href="https://wa.me/243990564877?text=Bonjour%20Uniterapide%2C%20j%27aimerais%20avoir%20des%20infos%20svp" target="_blank">üì± WhatsApp</a>
  <a class="t" href="https://t.me/cphkkk66" target="_blank">üí¨ Telegram</a>
</div>

<footer>
  <hr style="border-color:rgba(148,163,184,.2); border-style:solid; border-width:1px 0 0; margin-bottom:16px">
  <div>¬© <span id="year"></span> Unit√© Rapide ‚Äî RDC. Tous droits r√©serv√©s.</div>
</footer>

<!-- MODAL ACHAT / PAIEMENT -->
<div class="modal" id="payModal" aria-hidden="true">
  <div class="box">
    <div class="head">
      <strong id="payTitle">Acheter</strong>
      <button class="x" data-close>‚úï</button>
    </div>
    <div id="payBody"></div>
  </div>
</div>

<!-- MODAL PRODUIT (galerie) -->
<div class="modal" id="prodModal" aria-hidden="true">
  <div class="box">
    <div class="head">
      <strong id="prodTitle">Produit</strong>
      <button class="x" data-close>‚úï</button>
    </div>
    <div id="prodBody"></div>
  </div>
</div>

<!-- √âCRAN INSCRIPTION (style Betika) -->
<div class="gate" id="gate">
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <h3 style="margin:0">Bienvenue sur <span style="color:#34d399">Uniterapide</span></h3>
      <button class="x" id="skipGate">Passer</button>
    </div>
    <p class="muted" style="margin-top:4px">Entrez votre nom et num√©ro pour activer promos, j'aime & commentaires.</p>
    <div class="grid2">
      <input id="gateName" class="input" placeholder="Votre nom complet">
      <input id="gatePhone" class="input" placeholder="Votre num√©ro (ex: 099... / +243...)">
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn buy" id="gateSave">Activer mon compte</button>
    </div>
  </div>
</div>

<script>
// ========= CONFIG UTILISATEUR =========
const BRAND = "Uniterapide";
const WHATSAPP_NUM = "243990564877"; // format international pour click-to-chat
const TELEGRAM = "cphkkk66";
const AIRTEL_LABEL = "Mugisho St√©phane";
const AIRTEL_NUM = "+243 990 564 877";
const RATE_FC = 2800;

// FEUILLES GOOGLE (transform√©es en CSV automatique)
// Remplace juste les GID si tu changes d‚Äôonglets
const SHEET_PUBLIC_HTML = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRNgEaiSzpwmHuoj1bfIFzi9A34beLlxoqz8_ocD5hvb7I2T-4GRcamMbFRCKvw5-lKivYqo3Kpg0Ti/pubhtml?gid=0&single=true";
function htmlToCsv(url){
  const gidMatch = url.match(/gid=(\d+)/);
  const gid = gidMatch? gidMatch[1] : "0";
  return url.replace("/pubhtml?","/pub?").replace("single=true","output=csv").replace("html","").replace("pub?","pub?") + "&output=csv".replace("&&","&").replace("gid=0","gid="+gid);
}
const SHEET_CSV_URL = htmlToCsv(SHEET_PUBLIC_HTML);

// ========= COMPTEUR VISITES (CountAPI) + fallback =========
(function(){
  const badge = document.getElementById('visitsBadge');
  const ns = 'uniterapide_public_v2';
  fetch(`https://api.countapi.xyz/hit/${ns}/visits`).then(r=>r.json()).then(j=>{
    badge.textContent = `üëÅÔ∏è Visites : ${j.value.toLocaleString('fr-FR')}`;
  }).catch(()=>{
    const k='ur_visits_fallback'; const v=(parseInt(localStorage.getItem(k)||'0',10)+1);
    localStorage.setItem(k,String(v));
    badge.textContent = `üëÅÔ∏è Visites : ${v.toLocaleString('fr-FR')}*`;
  });
})();

// ========= VUES (local) =========
const localKeyViews = 'ur_views';
const v = parseInt(localStorage.getItem(localKeyViews) || '0', 10) + 1;
localStorage.setItem(localKeyViews, String(v));
document.getElementById('viewsLocal').textContent = v.toLocaleString('fr-FR');

// ========= LIKES (local) =========
(function(){
  const likeKey = 'ur_like';
  const likeBtn = document.getElementById('likeBtn');
  const likesCount = document.getElementById('likesCount');
  let liked = localStorage.getItem(likeKey) === '1';
  likesCount.textContent = liked ? 1 : 0;
  if(liked){ likeBtn.textContent = '‚ù§Ô∏è Merci'; likeBtn.disabled = true; }
  likeBtn.addEventListener('click', ()=>{
    if(liked) return;
    liked = true; localStorage.setItem(likeKey,'1');
    likesCount.textContent = 1; likeBtn.textContent='‚ù§Ô∏è Merci'; likeBtn.disabled=true;
    // Compteur global
    fetch(`https://api.countapi.xyz/hit/uniterapide_public_v2/like`).catch(()=>{});
  });
})();

// ========= INSCRIPTION (Gate) =========
const gate = document.getElementById('gate');
const clientNameEl = document.getElementById('clientName');
const clientPhoneEl = document.getElementById('clientPhone');

function loadClient(){
  const n = localStorage.getItem('ur_client_name')||'‚Äî';
  const p = localStorage.getItem('ur_client_phone')||'‚Äî';
  clientNameEl.textContent = n; clientPhoneEl.textContent = p;
}
loadClient();

if(!localStorage.getItem('ur_client_name') || !localStorage.getItem('ur_client_phone')){
  gate.style.display = 'flex';
}
document.getElementById('gateSave').onclick = ()=>{
  const n = (document.getElementById('gateName').value||'').trim();
  const p = (document.getElementById('gatePhone').value||'').trim();
  if(n.length<2 || p.length<7){ alert("Veuillez saisir un nom et un num√©ro valides."); return; }
  localStorage.setItem('ur_client_name', n);
  localStorage.setItem('ur_client_phone', p);
  gate.style.display='none'; loadClient();
};
document.getElementById('skipGate').onclick = ()=>{ gate.style.display='none'; };

// ========= CSV PARSER =========
function parseCSV(text){
  const rows=[]; let cur=[]; let cell=''; let inQ=false;
  for(let i=0;i<text.length;i++){
    const ch=text[i], nx=text[i+1];
    if(inQ){
      if(ch==='"' && nx==='"'){ cell+='"'; i++; }
      else if(ch==='"'){ inQ=false; }
      else cell+=ch;
    } else {
      if(ch==='"'){ inQ=true; }
      else if(ch===','){ cur.push(cell); cell=''; }
      else if(ch==='\n' || ch==='\r'){ if(cell!=='' || cur.length){ cur.push(cell); rows.push(cur); cur=[]; cell=''; } }
      else cell+=ch;
    }
  }
  if(cell!=='' || cur.length){ cur.push(cell); rows.push(cur); }
  return rows.filter(r=>r.some(c=>String(c).trim()!==''));
}

// ========= UI helpers =========
const cards = document.getElementById('cards');
const filtersEl = document.getElementById('filters');
const searchEl = document.getElementById('search');

function money(n){ try{ return Number(n).toLocaleString('fr-FR'); }catch(e){ return n; } }
function toSlug(s){ return (s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }

// ========= PRODUIT: Modals =========
const payModal = document.getElementById('payModal');
const payTitle = document.getElementById('payTitle');
const payBody = document.getElementById('payBody');
const prodModal = document.getElementById('prodModal');
const prodTitle = document.getElementById('prodTitle');
const prodBody = document.getElementById('prodBody');

document.querySelectorAll('[data-close]').forEach(b=> b.onclick = (e)=>{ e.target.closest('.modal').style.display='none'; });

// Ouvre modal paiement
function openPay(p){
  payTitle.textContent = "Acheter ‚Äî " + p.name;
  const clientN = localStorage.getItem('ur_client_name')||'Client';
  const clientP = localStorage.getItem('ur_client_phone')||'‚Äî';
  const amountFC = p.priceFC;
  const whatsMsg = encodeURIComponent(`Bonjour ${BRAND}, je veux acheter: ${p.name} (${p.cat}) √† ${amountFC} FC.\nNom: ${clientN}\nT√©l√©phone: ${clientP}`);
  payBody.innerHTML = `
    <div class="muted">Choisissez un moyen de paiement :</div>
    <div class="grid2" style="margin-top:8px">
      <button class="btn buy" id="pm_airtel">üí≥ Airtel Money</button>
      <a class="btn whatsapp" id="pm_whatsapp" href="https://wa.me/${WHATSAPP_NUM}?text=${whatsMsg}" target="_blank">üì± WhatsApp (commande)</a>
    </div>
    <div id="payStep" style="margin-top:12px"></div>
  `;
  document.getElementById('pm_airtel').onclick = ()=>{
    document.getElementById('payStep').innerHTML = `
      <div style="background:rgba(255,255,255,.05); padding:12px; border:1px solid rgba(148,163,184,.18); border-radius:12px">
        <div><strong>Montant:</strong> ${money(amountFC)} FC</div>
        <div><strong>Envoyez via Airtel Money √†:</strong> ${AIRTEL_LABEL} ‚Äî <strong>${AIRTEL_NUM}</strong></div>
        <ol class="muted" style="margin-top:8px">
          <li>Ouvrez Airtel Money (*501# ou l'app)</li>
          <li>Choisissez <strong>Transfert d'argent</strong></li>
          <li>Entrez le num√©ro: <strong>${AIRTEL_NUM}</strong></li>
          <li>Montant: <strong>${money(amountFC)} FC</strong></li>
          <li>Validez avec votre <strong>code PIN SIM</strong> (reste secret)</li>
        </ol>
        <div class="row" style="margin-top:8px">
          <button class="btn buy" id="btnPaid">‚úÖ J'ai pay√©</button>
          <button class="btn" style="background:#0000;border:1px solid rgba(148,163,184,.3);color:#cbd5e1" id="btnCopyNum">üìã Copier le num√©ro</button>
        </div>
      </div>
    `;
    document.getElementById('btnCopyNum').onclick = ()=>{ navigator.clipboard.writeText(AIRTEL_NUM); alert("Num√©ro copi√©."); };
    document.getElementById('btnPaid').onclick = ()=>{
      // trace achat (compteur global + local)
      fetch(`https://api.countapi.xyz/hit/uniterapide_public_v2/paid_${toSlug(p.name)}`).catch(()=>{});
      const k='ur_paid'; const list = JSON.parse(localStorage.getItem(k)||'[]');
      list.push({ts:Date.now(), name:p.name, cat:p.cat, fc:amountFC});
      localStorage.setItem(k, JSON.stringify(list));
      payBody.innerHTML = `<div style="padding:12px; border:1px solid rgba(16,185,129,.4); background:rgba(16,185,129,.15); border-radius:12px">
        ‚úÖ <strong>Paiement d√©clar√©</strong> ‚Äî Merci ! Nous confirmons sous peu sur WhatsApp.
      </div>`;
    };
  };
  payModal.style.display='flex';
}

// Ouvre modal produit + galerie (prend jusqu‚Äô√† 5 images, s√©par√©es par | dans la feuille)
function openProd(p){
  prodTitle.textContent = p.name;
  const imgs = (p.imgs && p.imgs.length)? p.imgs : [p.img];
  const big = imgs[0] || 'https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop';
  prodBody.innerHTML = `
    <img id="bigImg" src="${big}" alt="${p.name}" style="width:100%; max-height:300px; object-fit:cover; border-radius:12px; border:1px solid rgba(148,163,184,.2)">
    <div class="gallery">${imgs.map(u=>`<img src="${u}" alt="img" onclick="document.getElementById('bigImg').src='${u}'">`).join('')}</div>
    <div class="row" style="justify-content:space-between; margin-top:10px">
      <div>
        <div class="title">${p.name}</div>
        <div class="muted">${p.cat}${p.notes? ' ‚Ä¢ '+p.notes:''}</div>
        <div class="price"><span class="fc">${money(p.priceFC)} FC</span> ${p.priceUSD? `<span class="usd">(~ ${money(p.priceUSD)} $)</span>`:''}</div>
      </div>
      ${p.promo? `<span class="badge-timer">üéØ ${p.promo}</span>`:''}
    </div>
    <div class="cta" style="margin-top:12px">
      <button class="btn buy" onclick='openPay(${JSON.stringify(p).replace(/'/g,"&apos;")})'>üõí Acheter</button>
      <a class="btn whatsapp" target="_blank" href="https://wa.me/${WHATSAPP_NUM}?text=${encodeURIComponent('Bonjour '+BRAND+', int√©ress√© par: '+p.name+' ('+p.cat+')')}">üì± WhatsApp</a>
    </div>
  `;
  prodModal.style.display='flex';
}

// ========= RENDER =========
let PRODUCTS = [];
function buildFilters(products){
  const cats = Array.from(new Set(products.map(p=>p.cat))).filter(Boolean);
  filtersEl.innerHTML = ['_all', ...cats].map(c=>`<span class="chip${c==='_all'? ' active':''}" data-cat="${c}">${c==='_all'? 'Tout':c}</span>`).join('');
  filtersEl.querySelectorAll('.chip').forEach(el=>{
    el.addEventListener('click',()=>{
      filtersEl.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
      el.classList.add('active');
      const cat = el.getAttribute('data-cat');
      renderCards(cat==='_all'? PRODUCTS : PRODUCTS.filter(p=>p.cat===cat));
    })
  })
}

function renderCards(list){
  const q = (searchEl.value||'').toLowerCase().trim();
  const filtered = q? list.filter(p => (p.name+' '+p.cat+' '+(p.notes||'')).toLowerCase().includes(q)) : list;
  cards.innerHTML = filtered.map(p=>{
    const promo = p.promo? `<span class="badge-timer" data-deadline="${p.deadline||''}">üéØ ${p.promo}</span>` : '';
    const img = p.img;
    return `
      <article class="card">
        <img loading="lazy" src="${img}" alt="${p.name}" onclick='openProd(${JSON.stringify(p).replace(/'/g,"&apos;")})'>
        <div class="p">
          <div class="row" style="justify-content:space-between; align-items:flex-start">
            <div class="title">${p.name}</div>
            ${promo}
          </div>
          <div class="muted">${p.cat}${p.notes? ' ‚Ä¢ '+p.notes:''}</div>
          <div class="price"><div class="fc">${money(p.priceFC)} FC</div> ${p.priceUSD? `<div class="usd">(~ ${money(p.priceUSD)} $)</div>`:''}</div>
          <div class="cta">
            <button class="btn buy" onclick='openPay(${JSON.stringify(p).replace(/'/g,"&apos;")})'>üõí Acheter</button>
            <a class="btn whatsapp" href="https://wa.me/${WHATSAPP_NUM}?text=${encodeURIComponent('Bonjour '+BRAND+', int√©ress√© par: '+p.name+' ('+p.cat+')')}" target="_blank">üì± WhatsApp</a>
          </div>
        </div>
      </article>`;
  }).join('');
}

searchEl.addEventListener('input', ()=> renderCards(PRODUCTS));

// ========= LOAD SHEET =========
// Feuille attendue (en-t√™tes, insensible √† la casse) :
// Cat√©gorie | Nom du produit | Lien image | Prix $ | Franc (total) | Promo | Lien | Notes | Stock | Images (URLs s√©par√©es par |)
async function load(){
  let products=[];
  try{
    const res = await fetch(SHEET_CSV_URL, {cache:'no-store'});
    const txt = await res.text();
    const rows = parseCSV(txt);
    const hdr = rows[0].map(h=>h.trim().toLowerCase());
    const idx = {
      cat: hdr.indexOf('cat√©gorie'),
      name: hdr.indexOf('nom du produit'),
      img: hdr.indexOf('lien image'),
      usd: hdr.indexOf('prix $'),
      fc: hdr.indexOf('franc (total)'),
      promo: hdr.indexOf('promo'),
      link: hdr.indexOf('lien'),
      notes: hdr.indexOf('notes'),
      stock: hdr.indexOf('stock'),
      images: hdr.indexOf('images')
    };
    for(let i=1;i<rows.length;i++){
      const r=rows[i]; if(!r || !r.length) continue;
      const usd = parseFloat((r[idx.usd]||'').toString().replace(/[^0-9.\-]/g,'')); const hasUSD=!isNaN(usd);
      const fc  = parseFloat((r[idx.fc]||'').toString().replace(/[^0-9.\-]/g,'')); const hasFC=!isNaN(fc);
      const priceFC = hasFC? fc : (hasUSD? Math.round(usd*RATE_FC) : 0);
      const img = (r[idx.img]||'').trim() || 'https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop';
      const extraImgs = ((r[idx.images]||'').trim()).split('|').map(s=>s.trim()).filter(Boolean).slice(0,5);
      products.push({
        cat: (r[idx.cat]||'Autres').trim(),
        name: (r[idx.name]||'Sans nom').trim(),
        img, imgs: extraImgs.length? [img, ...extraImgs].slice(0,5) : [img],
        priceUSD: hasUSD? usd:null,
        priceFC,
        promo: (r[idx.promo]||'').trim(),
        link: (r[idx.link]||'').trim(),
        notes: (r[idx.notes]||'').trim(),
        stock: (r[idx.stock]||'').trim()
      });
    }
  }catch(e){
    console.error('Erreur Sheet', e);
  }
  products = products.filter(p=>p.name && p.priceFC>0);
  PRODUCTS = products;
  buildFilters(PRODUCTS);
  renderCards(PRODUCTS);
}
load();

document.getElementById('year').textContent = new Date().getFullYear();
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit√© Rapide ‚Äî Admin</title>
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data:; img-src 'self' https: data:; style-src 'self' 'unsafe-inline' https:; script-src 'self' 'unsafe-inline' https:; connect-src 'self' https:;" />
<style>
:root{--bg:#0b1020; --card:#111827; --muted:#94a3b8; --brand:#10b981; --danger:#ef4444; --info:#3b82f6; --amber:#f59e0b; --text:#e5e7eb; --shadow:0 10px 30px rgba(0,0,0,.35)}
*{box-sizing:border-box} body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif; background:radial-gradient(1200px 800px at 10% 10%, #0b1225 0%, #0f172a 40%, #0a0f1f 100%); color:var(--text)}
.wrap{max-width:1150px; margin:0 auto; padding:16px 20px}
.card{background:linear-gradient(180deg, rgba(17,24,39,.95), rgba(17,24,39,.85)); border:1px solid rgba(148,163,184,.18); border-radius:18px; box-shadow:var(--shadow); padding:16px}
.grid{display:grid; gap:14px}
.grid.cols-3{grid-template-columns:repeat(3,1fr)}
h2{margin:8px 0 12px}
.input{width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(148,163,184,.25); background:rgba(255,255,255,.06); color:#fff}
.btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 12px; border-radius:12px; border:1px solid transparent; cursor:pointer; font-weight:800; color:#fff}
.btn.primary{background:#10b98122; border:1px solid #10b98166}
.btn.danger{background:#ef444422; border:1px solid #ef444455}
.table{width:100%; border-collapse:collapse}
.table th,.table td{border-bottom:1px solid rgba(148,163,184,.18); padding:8px 6px; font-size:.95rem}
.badge{padding:4px 8px; border-radius:999px; border:1px solid rgba(148,163,184,.3); font-weight:700; font-size:.8rem}
.row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.muted{color:var(--muted)}
.center{display:flex; align-items:center; justify-content:center}
.hidden{display:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="loginCard">
    <h2>Connexion Admin</h2>
    <div class="grid" style="grid-template-columns:1fr 1fr; gap:10px">
      <input id="admUser" class="input" placeholder="Nom admin (ex: phabogard)">
      <input id="admPin" class="input" placeholder="PIN admin" type="password" inputmode="numeric">
    </div>
    <div class="row" style="margin-top:10px">
      <button class="btn primary" id="btnLogin">Se connecter</button>
    </div>
    <p class="muted">Acc√®s r√©serv√© ‚Äî journal des acc√®s enregistr√© localement.</p>
  </div>

  <div class="card hidden" id="app">
    <div class="row" style="justify-content:space-between">
      <h2>Tableau de bord ‚Äî Unit√© Rapide</h2>
      <button class="btn danger" id="btnLogout">Se d√©connecter</button>
    </div>

    <div class="grid cols-3">
      <div class="card">
        <div class="muted">üëÅÔ∏è Visites (global)</div>
        <div id="statVisits" style="font-size:1.6rem; font-weight:900">‚Äî</div>
      </div>
      <div class="card">
        <div class="muted">üõí Achats d√©clar√©s (local + global)</div>
        <div id="statPaid" style="font-size:1.6rem; font-weight:900">‚Äî</div>
      </div>
      <div class="card">
        <div class="muted">üí∏ Gains estim√©s</div>
        <div id="statRevenue" style="font-size:1.6rem; font-weight:900">‚Äî</div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="row" style="justify-content:space-between">
        <strong>Ventes locales (cet appareil)</strong>
        <div class="row">
          <button class="btn primary" id="btnExport">Exporter (CSV)</button>
          <button class="btn danger" id="btnClear">Effacer local</button>
        </div>
      </div>
      <table class="table" id="tblSales">
        <thead><tr><th>Date</th><th>Produit</th><th>Cat√©gorie</th><th>Montant (FC)</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="card" style="margin-top:14px">
      <strong>Param√®tres boutique</strong>
      <div class="grid" style="grid-template-columns:1fr 1fr 1fr; gap:10px; margin-top:8px">
        <div><div class="muted">Nom</div><input id="cfgBrand" class="input"></div>
        <div><div class="muted">WhatsApp (international)</div><input id="cfgWa" class="input" placeholder="243..."></div>
        <div><div class="muted">Airtel Money (texte)</div><input id="cfgAirtelName" class="input" placeholder="Nom sur compte"></div>
        <div><div class="muted">Airtel Money (num√©ro affich√©)</div><input id="cfgAirtelNum" class="input" placeholder="+243 ..."></div>
        <div><div class="muted">Taux FC/$</div><input id="cfgRate" class="input" type="number" step="1"></div>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn primary" id="btnSaveCfg">Enregistrer (local)</button>
      </div>
      <p class="muted">Ces param√®tres modifient l‚Äôaffichage c√¥t√© public (sur ce m√™me appareil) via le stockage local. Pour propager √† tous, mettez √† jour votre Google Sheet publique.</p>
    </div>

    <div class="card" style="margin-top:14px">
      <strong>Alertes</strong>
      <ul id="alerts" class="muted" style="margin-top:6px"></ul>
    </div>
  </div>
</div>

<script>
// ====== CREDS ADMIN (ceux qu‚Äôon a convenu) ======
const ADMIN_USER = "phabogard";
const ADMIN_PIN  = "6996698877";

// ====== Feuille PUBLIC (pour calculer estimations si besoin) ======
const SHEET_PUBLIC_HTML = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRNgEaiSzpwmHuoj1bfIFzi9A34beLlxoqz8_ocD5hvb7I2T-4GRcamMbFRCKvw5-lKivYqo3Kpg0Ti/pubhtml?gid=0&single=true";
function htmlToCsv(url){
  const gidMatch = url.match(/gid=(\\d+)/);
  const gid = gidMatch? gidMatch[1] : "0";
  return url.replace("/pubhtml?","/pub?").replace("single=true","output=csv").replace("html","").replace("pub?","pub?") + "&output=csv".replace("&&","&").replace("gid=0","gid="+gid);
}
const SHEET_CSV_URL = htmlToCsv(SHEET_PUBLIC_HTML);

// ====== LOGIN ======
const loginCard = document.getElementById('loginCard');
const app = document.getElementById('app');
document.getElementById('btnLogin').onclick = ()=>{
  const u = (document.getElementById('admUser').value||'').trim();
  const p = (document.getElementById('admPin').value||'').trim();
  if(u===ADMIN_USER && p===ADMIN_PIN){
    localStorage.setItem('ur_admin_session','1');
    loginCard.classList.add('hidden'); app.classList.remove('hidden');
    boot();
  }else{
    alert("Identifiants invalides.");
  }
};
document.getElementById('btnLogout').onclick=()=>{
  localStorage.removeItem('ur_admin_session');
  location.reload();
};
if(localStorage.getItem('ur_admin_session')==='1'){
  loginCard.classList.add('hidden'); app.classList.remove('hidden');
  boot();
}

// ====== STATS VISITES (CountAPI) & PAID ======
async function getVisits(){
  try{
    const r = await fetch("https://api.countapi.xyz/get/uniterapide_public_v2/visits");
    const j = await r.json();
    return j.value||0;
  }catch(e){ return 0; }
}
async function getPaidSumLocal(){
  const list = JSON.parse(localStorage.getItem('ur_paid')||'[]');
  return {count:list.length, sum:list.reduce((a,b)=>a+Number(b.fc||0),0), list};
}

// ====== RENDER TABLE SALES ======
function renderSales(list){
  const tb = document.querySelector('#tblSales tbody');
  tb.innerHTML = list.map(x=>{
    const d = new Date(x.ts);
    return `<tr><td>${d.toLocaleString('fr-FR')}</td><td>${x.name}</td><td>${x.cat}</td><td>${Number(x.fc).toLocaleString('fr-FR')} FC</td></tr>`;
  }).join('');
}

// ====== EXPORT CSV ======
function exportCSV(rows, filename="ventes_uniterapide.csv"){
  const hdr = "date,produit,cat√©gorie,fc\\n";
  const body = rows.map(x=>{
    const d = new Date(x.ts);
    return `"${d.toISOString()}","${(x.name||'').replace(/"/g,'""')}","${(x.cat||'').replace(/"/g,'""')}",${x.fc}`;
  }).join("\\n");
  const blob = new Blob([hdr+body],{type:"text/csv;charset=utf-8;"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob); a.download = filename; a.click();
}

// ====== CONFIG LOCALE ======
function loadCfg(){
  document.getElementById('cfgBrand').value = localStorage.getItem('cfg_brand')||'Uniterapide';
  document.getElementById('cfgWa').value = localStorage.getItem('cfg_wa')||'243990564877';
  document.getElementById('cfgAirtelName').value = localStorage.getItem('cfg_airtel_name')||'Mugisho St√©phane';
  document.getElementById('cfgAirtelNum').value = localStorage.getItem('cfg_airtel_num')||'+243 990 564 877';
  document.getElementById('cfgRate').value = localStorage.getItem('cfg_rate')||'2800';
}
function saveCfg(){
  localStorage.setItem('cfg_brand', document.getElementById('cfgBrand').value.trim());
  localStorage.setItem('cfg_wa', document.getElementById('cfgWa').value.trim());
  localStorage.setItem('cfg_airtel_name', document.getElementById('cfgAirtelName').value.trim());
  localStorage.setItem('cfg_airtel_num', document.getElementById('cfgAirtelNum').value.trim());
  localStorage.setItem('cfg_rate', document.getElementById('cfgRate').value.trim());
  alert("Param√®tres enregistr√©s (locaux).");
}

// ====== ALERTES SIMPLE ======
function addAlert(msg){ const ul=document.getElementById('alerts'); const li=document.createElement('li'); li.textContent=msg; ul.appendChild(li); }
async function boot(){
  loadCfg();

  // visites
  const v = await getVisits();
  document.getElementById('statVisits').textContent = v.toLocaleString('fr-FR');

  // paid
  const paidLocal = await getPaidSumLocal();
  document.getElementById('statPaid').textContent = `${paidLocal.count} achats / ${paidLocal.sum.toLocaleString('fr-FR')} FC`;
  renderSales(paidLocal.list);

  // gains estim√©s (ex: 8% de marge configurable ici)
  const MARGE = 0.08;
  const revenue = Math.round(paidLocal.sum * MARGE);
  document.getElementById('statRevenue').textContent = `${revenue.toLocaleString('fr-FR')} FC (‚âà ${Math.round(revenue/ (Number(localStorage.getItem('cfg_rate')||'2800')))} $)`;

  // alertes basiques
  if(v===0) addAlert("Alerte: compteur de visites indisponible.");
  if(paidLocal.count===0) addAlert("Alerte: aucun achat d√©clar√© localement pour le moment.");
  if(!localStorage.getItem('cfg_brand')) addAlert("Recommandation: compl√©tez vos param√®tres boutique.");
}

// actions
document.getElementById('btnExport').onclick = async ()=>{
  const paidLocal = await getPaidSumLocal();
  exportCSV(paidLocal.list);
};
document.getElementById('btnClear').onclick = ()=>{
  if(confirm("Effacer les ventes locales sur cet appareil ?")){ localStorage.removeItem('ur_paid'); boot(); }
};
document.getElementById('btnSaveCfg').onclick = saveCfg;
</script>
</body>
</html></script>
</body>
  </html>
