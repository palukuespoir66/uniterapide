here<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Uniterapide ‚Äî Boutique</title>

<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data:; img-src 'self' https: data: blob:; style-src 'self' 'unsafe-inline' https:; script-src 'self' 'unsafe-inline' https:; connect-src 'self' https:;" />

<style>
  :root{
    --bg:#0b0f1a; --bg2:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#94a3b8;
    --brand:#10b981; --info:#3b82f6; --accent:#f59e0b; --danger:#ef4444; --ok:#22c55e;
    --ring: rgba(59,130,246,.45); --bd: rgba(148,163,184,.2);
  }
  [data-theme="light"]{
    --bg:#f4f6fb; --bg2:#e9eef8; --card:#ffffff; --text:#0f172a; --muted:#475569;
    --ring: rgba(59,130,246,.25); --bd: rgba(15,23,42,.12);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
    background: radial-gradient(1200px 800px at 10% 10%, var(--bg2) 0%, var(--bg) 40%, #0a0f1f 100%);
    overflow-x:hidden;
  }
  .bg-anim{position:fixed; inset:-20vmax; z-index:-1; filter:blur(80px) saturate(130%); opacity:.35;
    background: conic-gradient(from 180deg, #00c2ff, #7c3aed, var(--brand), var(--accent), #00c2ff);
    animation: spin 28s linear infinite;}
  @keyframes spin{to{transform:rotate(1turn)}}

  header{position:sticky; top:0; z-index:40; backdrop-filter:saturate(140%) blur(8px);
    background: linear-gradient(180deg, rgba(2,6,23,.85), rgba(2,6,23,.55)); border-bottom:1px solid var(--bd);}
  [data-theme="light"] header{background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.7));}
  .wrap{max-width:1150px; margin:0 auto; padding:14px 18px}
  .row{display:flex; gap:14px; align-items:center; flex-wrap:wrap}
  .brand{display:flex; align-items:center; gap:10px; font-weight:800}
  .logo{width:38px; height:38px; border-radius:12px; display:grid; place-items:center; color:white;
    background:linear-gradient(135deg, var(--brand), var(--info)); box-shadow:0 10px 30px rgba(0,0,0,.35); font-weight:900}
  .muted{color:var(--muted)}
  .badges{display:flex; gap:10px; flex-wrap:wrap}
  .badge{background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); border:1px solid var(--bd);
    padding:8px 12px; border-radius:999px; font-weight:600; display:flex; align-items:center; gap:8px}
  main{max-width:1150px; margin:20px auto 80px; padding:0 18px}
  .promo{background:linear-gradient(90deg, rgba(16,185,129,.15), rgba(59,130,246,.15)); border:1px solid rgba(16,185,129,.25);
    padding:10px 14px; border-radius:12px; font-weight:600; display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap; color:#d1fae5}
  [data-theme="light"] .promo{color:#064e3b}

  /* Auth rapide */
  .auth{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
  .in{padding:10px 12px; border-radius:10px; border:1px solid var(--bd); background:var(--card); color:var(--text)}
  [data-theme="light"] .in{background:#fff}
  .btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 12px; border-radius:12px; border:1px solid transparent; font-weight:800; cursor:pointer}
  .btn.brand{background:linear-gradient(135deg, var(--brand), var(--info)); color:#fff}
  .btn.whatsapp{background:#25D36622; border-color:#25D36655; color:#c3f9d7}
  .btn.telegram{background:#229ED922; border-color:#229ED955; color:#cfe9ff}
  .btn.ghost{background:transparent; border:1px solid var(--bd); color:var(--text)}
  .btn:hover{transform:translateY(-1px)}

  /* Tools bar */
  .tools{display:flex; gap:8px; flex-wrap:wrap; margin:12px 0}
  .chip{padding:8px 12px; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid var(--bd); cursor:pointer; font-weight:700}
  .chip.active{background:linear-gradient(90deg, rgba(16,185,129,.25), rgba(59,130,246,.25)); border-color:#34d39977}
  .search{flex:1; min-width:240px}
  .select{padding:10px 12px; border-radius:10px; border:1px solid var(--bd); background:var(--card); color:var(--text)}

  /* Cards */
  .cards{display:grid; grid-template-columns:repeat( auto-fit, minmax(240px, 1fr) ); gap:16px}
  .card{background:linear-gradient(180deg, rgba(17,24,39,.85), rgba(17,24,39,.65));
    border:1px solid var(--bd); border-radius:18px; overflow:hidden; display:flex; flex-direction:column; min-height:100%}
  [data-theme="light"] .card{background:#fff}
  .thumb{width:100%; height:180px; object-fit:cover; background:#0b1020}
  .p{padding:12px 14px}
  .title{font-weight:800; font-size:1.06rem}
  .price{display:flex; align-items:center; gap:10px; margin:6px 0}
  .price .fc{font-weight:900; font-size:1.12rem}
  .price .usd{color:#93c5fd; font-weight:700}
  .row-b{display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap}

  /* Stats bar */
  .stats{display:flex; gap:12px; flex-wrap:wrap; margin:14px 0}
  .stat{background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02)); border:1px solid var(--bd);
    padding:10px 14px; border-radius:14px; font-weight:700}

  /* Float */
  .float{position:fixed; right:18px; bottom:18px; display:flex; flex-direction:column; gap:10px; z-index:50}
  .float a{display:flex; align-items:center; gap:8px; padding:10px 12px; border-radius:999px; text-decoration:none; font-weight:800; box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .float .w{background:#25D366; color:#06250f}
  .float .t{background:#229ED9; color:#041e2a}

  footer{max-width:1150px; margin:40px auto; padding:0 18px 60px}
  .pay{display:flex; gap:10px; flex-wrap:wrap}
  .pill{background:rgba(255,255,255,.07); border:1px solid var(--bd); padding:8px 12px; border-radius:999px; font-weight:700}

  details{background:rgba(255,255,255,.05); border:1px solid var(--bd); padding:12px; border-radius:14px}
  details summary{cursor:pointer; font-weight:900}

  /* Modal */
  .modal{position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.6); z-index:60}
  .modal.show{display:flex}
  .sheet{background:var(--card); border:1px solid var(--bd); border-radius:16px; padding:16px; max-width:920px; width:min(92vw,920px); color:var(--text)}
  [data-theme="light"] .sheet{background:#fff}
  .close{cursor:pointer; border:none; background:transparent; font-size:20px; color:var(--muted)}

  /* Gallery */
  .gallery{display:grid; grid-template-columns:1fr; gap:10px}
  .big{width:100%; height:360px; object-fit:cover; border-radius:12px}
  .thumbs{display:grid; grid-template-columns:repeat(5, 1fr); gap:8px}
  .timg{height:70px; object-fit:cover; border-radius:10px; cursor:pointer; border:2px solid transparent}
  .timg.active{border-color:var(--ring)}

  /* Comments */
  .comments{margin-top:12px}
  .comment{border-top:1px dashed var(--bd); padding:8px 0}
  .stars{cursor:pointer; font-size:18px}
  .toast{position:fixed; top:12px; right:12px; background:var(--card); border:1px solid var(--bd); padding:10px 12px; border-radius:10px; z-index:70}
</style>
</head>
<body>
  <div class="bg-anim"></div>

  <header>
    <div class="wrap">
      <div class="row" style="justify-content:space-between">
        <div class="brand">
          <div class="logo">UR</div>
          <div>
            <div style="font-size:1.05rem">Uniterapide</div>
            <div class="muted" style="font-size:.85rem">Unit√©s ‚Ä¢ T√©l√©phones ‚Ä¢ V√™tements ‚Ä¢ Accessoires</div>
          </div>
        </div>

        <div class="badges">
          <div class="badge">üîí S√©curis√©</div>
          <div class="badge">üöö Livraison rapide</div>
          <div class="badge">‚≠ê Qualit√© garantie</div>
          <div class="badge">üïò 24/7</div>
          <div class="badge" id="visitsBadge">üëÅÔ∏è Visites : ‚Ä¶</div>
          <div class="badge">
            <select id="lang" class="select">
              <option value="fr">FR</option>
              <option value="en">EN</option>
            </select>
          </div>
          <button id="themeBtn" class="btn ghost">üåì</button>
        </div>
      </div>

      <div class="promo" style="margin-top:10px">
        <div>üî• <strong>Promos</strong> cette semaine sur t√©l√©phones, unit√©s & accessoires ‚Äî meilleurs prix garantis.</div>
        <div class="muted">WhatsApp : <strong>+243 990 564 877</strong> ‚Ä¢ Telegram : <strong>@cphkkk66</strong></div>
      </div>

      <!-- Inscription rapide -->
      <div class="auth">
        <input id="custName" class="in" placeholder="Votre nom (obligatoire)" />
        <input id="custPhone" class="in" placeholder="T√©l√©phone ex: 0990564877" />
        <button id="saveProfile" class="btn brand">Enregistrer</button>
        <span id="hello" class="muted"></span>
      </div>
    </div>
  </header>

  <main>
    <section class="stats">
      <div class="stat">üëÅÔ∏è Vues (ce navigateur) : <span id="viewsLocal">0</span></div>
      <div class="stat">‚ù§Ô∏è J'aime : <span id="likesCount">0</span> <button id="likeBtn" class="chip" style="margin-left:8px">+ J'aime</button></div>
      <div class="stat">üîÑ Partages : <span id="shareCount">0</span> <button id="shareBtn" class="chip" style="margin-left:8px">Partager</button></div>
      <div class="stat">üì∂ √âtat : Public</div>
    </section>

    <!-- Outils -->
    <section>
      <div class="tools">
        <input id="q" class="in search" placeholder="Recherche produit‚Ä¶" />
        <select id="sort" class="select">
          <option value="new">üÜï Nouveaut√©s</option>
          <option value="priceAsc">‚¨áÔ∏è Prix (FC)</option>
          <option value="priceDesc">‚¨ÜÔ∏è Prix (FC)</option>
          <option value="pop">üî• Popularit√©</option>
        </select>
        <div id="filters" class="tools"></div>
      </div>
    </section>

    <!-- Catalogue -->
    <section>
      <h2>Catalogue</h2>
      <div id="cards" class="cards">Chargement‚Ä¶</div>
    </section>

    <!-- Ventes d'unit√©s -->
    <section style="margin-top:28px">
      <h2>Unit√©s & Forfaits ‚Äî Promos</h2>
      <div class="cards" id="units">
        <!-- Rendu par JS -->
      </div>
    </section>

    <!-- Contact -->
    <section style="margin-top:28px">
      <h2>Contact</h2>
      <div class="row">
        <a class="btn whatsapp" href="https://wa.me/243990564877" target="_blank">üì± WhatsApp</a>
        <a class="btn telegram" href="https://t.me/cphkkk66" target="_blank">üí¨ Telegram</a>
      </div>
    </section>

    <!-- Paiements -->
    <section style="margin-top:28px">
      <h2>Modes de paiement</h2>
      <div class="pay">
        <span class="pill">üí≥ Airtel Money ‚Äî <strong>Mugisho St√©phane</strong> ‚Äî <strong>+243 990 564 877</strong></span>
        <span class="pill">üì≤ M-Pesa (Vodacom)</span>
        <span class="pill">üü† Orange Money</span>
        <span class="pill">üü£ Afrimoney (Africell)</span>
        <span class="pill">üü° MoMo (MTN)</span>
      </div>
    </section>

    <!-- Infos s√©curit√© -->
    <section style="margin-top:28px">
      <details>
        <summary>üîß Param√®tres & S√©curit√© (infos client)</summary>
        <ul>
          <li>Ce site affiche seulement les <strong>produits et prix</strong>. Aucune donn√©e sensible n'est publique.</li>
          <li>Les mises √† jour viennent d‚Äôune feuille <strong>PUBLIC (lecture)</strong> ou CSV h√©berg√©.</li>
          <li>Contacts officiels : WhatsApp <strong>+243 990 564 877</strong>, Telegram <strong>@cphkkk66</strong>, Airtel Money <strong>Mugisho St√©phane</strong>.</li>
          <li>‚ö†Ô∏è Le paiement sur le site est une <strong>simulation de confirmation</strong>. <u>Ne saisissez jamais votre vrai code SIM</u>. Le paiement r√©el se fait via Airtel Money/USSD/app.</li>
        </ul>
      </details>
    </section>
  </main>

  <!-- Boutons flottants -->
  <div class="float">
    <a class="w" href="https://wa.me/243990564877" target="_blank">üì± WhatsApp</a>
    <a class="t" href="https://t.me/cphkkk66" target="_blank">üí¨ Telegram</a>
  </div>

  <footer>
    <hr style="border-color:var(--bd); border-style:solid; border-width:1px 0 0; margin-bottom:16px">
    <div>¬© <span id="year"></span> Uniterapide ‚Äî RDC. Tous droits r√©serv√©s.</div>
  </footer>

  <!-- Modal Produit -->
  <div id="productModal" class="modal" role="dialog" aria-modal="true">
    <div class="sheet">
      <div class="row-b">
        <div style="font-weight:900" id="pmTitle">Produit</div>
        <button class="close" id="pmClose">‚úñ</button>
      </div>
      <div class="gallery" style="margin-top:8px">
        <img id="pmBig" class="big" src="" alt="">
        <div id="pmThumbs" class="thumbs"></div>
      </div>
      <div style="margin-top:10px" class="muted" id="pmMeta"></div>
      <div class="price" id="pmPrice" style="margin-top:6px"></div>
      <div class="row" style="margin-top:8px; flex-wrap:wrap; gap:8px">
        <input id="pmQty" class="in" type="number" min="1" value="1" style="width:110px" />
        <button id="pmBuyAirtel" class="btn brand">Acheter ‚Äî Airtel Money</button>
        <a id="pmWhats" class="btn whatsapp" target="_blank">Commander sur WhatsApp</a>
        <button id="pmShare" class="btn ghost">Partager</button>
      </div>

      <!-- Ratings & comments -->
      <div class="comments">
        <div><strong>Avis & Notes</strong></div>
        <div id="pmStars" class="stars" aria-label="Notation">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
        <div class="row" style="margin-top:8px">
          <input id="pmComment" class="in" placeholder="Laissez un commentaire‚Ä¶" style="flex:1" />
          <button id="pmAddComment" class="btn ghost">Publier</button>
        </div>
        <div id="pmCommentList"></div>
      </div>
    </div>
  </div>

  <!-- Modal Paiement (simulation) -->
  <div id="payModal" class="modal" role="dialog" aria-modal="true">
    <div class="sheet" style="max-width:520px">
      <div class="row-b">
        <div style="font-weight:900">Airtel Money ‚Äî Confirmation</div>
        <button class="close" id="payClose">‚úñ</button>
      </div>
      <div id="paySummary" style="margin-top:10px"></div>
      <div class="pill" style="margin:10px 0; line-height:1.4">
        ‚ö†Ô∏è <strong>Simulation</strong> : ne saisissez <u>jamais</u> votre vrai code SIM. Utilisez le code de test <strong>1515</strong> pour valider.
      </div>
      <input id="payPin" class="in" placeholder="PIN de test (1515)" maxlength="4" style="width:160px" />
      <div class="row" style="margin-top:10px">
        <button id="payConfirm" class="btn brand">Payer</button>
        <button id="payCancel" class="btn ghost">Annuler</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" style="display:none"></div>

<script>
/* ================== CONFIG ================== */
// Mets ici tes CSV publics (Option 1). Tu peux en lister plusieurs.
const CSV_URLS = [
  // Exemples: (remplace par tes liens CSV "export?format=csv" ou GitHub raw)
  // "https://raw.githubusercontent.com/toncompte/tonrepo/main/produits.csv"
];

// Phrase WhatsApp
const WHATSAPP_PHONE_INTL = "243990564877"; // pour wa.me
const WHATSAPP_DISPLAY = "+243 990 564 877";
const TELEGRAM = "@cphkkk66";
const BRAND = "Uniterapide";
const AIRTEL_NAME = "Mugisho St√©phane";
const AIRTEL_MAIN_NUMBER = "0990564877";
const AIRTEL_PIN_TEST = "1515";
const USD_RATE = 2800; // fallback si pas de colonne FC
const COUNTAPI_NS = "uniterapide_pub_v2";

/* ================== UTIL ================== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const fmt = n => isNaN(n)? n : Number(n).toLocaleString('fr-FR');
const money = (n, curr="FC") => `${fmt(n)} ${curr}`;
const toast = (t, ms=2500) => { const el=$("#toast"); el.textContent=t; el.style.display='block'; setTimeout(()=>el.style.display='none', ms); };
const store = {
  get(k, def=null){ try{ return JSON.parse(localStorage.getItem(k)) ?? def }catch(e){ return def }},
  set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
};

/* ================== I18N (simple) ================== */
const i18n = {
  fr: {
    search:"Recherche produit‚Ä¶", new:"Nouveaut√©s", priceAsc:"Prix croissant", priceDesc:"Prix d√©croissant",
    pop:"Popularit√©", buy:"Acheter ‚Äî Airtel Money", share:"Partager", commentPH:"Laissez un commentaire‚Ä¶",
    rate:"Notez ce produit", added:"Ajout√© !", paid:"Paiement simul√© valid√© ‚úÖ", wrongPin:"PIN incorrect ‚ùå"
  },
  en: {
    search:"Search products‚Ä¶", new:"Newest", priceAsc:"Price ‚Üë", priceDesc:"Price ‚Üì",
    pop:"Popularity", buy:"Buy ‚Äî Airtel Money", share:"Share", commentPH:"Leave a comment‚Ä¶",
    rate:"Rate this product", added:"Added!", paid:"Simulated payment success ‚úÖ", wrongPin:"Wrong PIN ‚ùå"
  }
};
function setLang(l){
  store.set('lang', l);
  $("#q").placeholder = i18n[l].search;
  $("#pmBuyAirtel").textContent = i18n[l].buy;
  $("#pmShare").textContent = i18n[l].share;
  $("#pmComment").placeholder = i18n[l].commentPH;
}
$("#lang").addEventListener('change', e=> setLang(e.target.value));

/* ================== Th√®me ================== */
function applyTheme(t){ document.documentElement.setAttribute('data-theme', t); store.set('theme', t); }
$("#themeBtn").addEventListener('click', ()=>{
  const cur = document.documentElement.getAttribute('data-theme') || 'dark';
  applyTheme(cur==='dark' ? 'light' : 'dark');
});

/* ================== Compteurs ================== */
(function visits(){
  const badge = $("#visitsBadge");
  fetch(`https://api.countapi.xyz/hit/${COUNTAPI_NS}/visits`).then(r=>r.json()).then(j=>{
    badge.textContent = `üëÅÔ∏è Visites : ${j.value.toLocaleString('fr-FR')}`;
  }).catch(()=>{
    const k='visits_fallback'; const v=(parseInt(localStorage.getItem(k)||'0',10)+1);
    localStorage.setItem(k,String(v));
    badge.textContent = `üëÅÔ∏è Visites : ${v.toLocaleString('fr-FR')}*`;
  });
})();
(function viewsLocal(){
  const k='views_local'; const v=(parseInt(localStorage.getItem(k)||'0',10)+1);
  localStorage.setItem(k,String(v)); $("#viewsLocal").textContent = v.toLocaleString('fr-FR');
})();
(function likesLocal(){
  const k='like_site'; const liked=localStorage.getItem(k)==='1';
  $("#likesCount").textContent = liked? 1 : 0;
  if(liked){ const b=$("#likeBtn"); b.textContent='‚ù§Ô∏è Merci'; b.disabled=true; }
  $("#likeBtn").addEventListener('click', ()=>{
    if(localStorage.getItem(k)==='1') return;
    localStorage.setItem(k,'1'); $("#likesCount").textContent=1; const b=$("#likeBtn"); b.textContent='‚ù§Ô∏è Merci'; b.disabled=true;
  });
})();
$("#shareBtn").addEventListener('click', async ()=>{
  try{
    if(navigator.share){ await navigator.share({title:BRAND, text:"D√©couvrez nos promos üî•", url:location.href}); }
    const k='share_count'; const v=(parseInt(localStorage.getItem(k)||'0',10)+1);
    localStorage.setItem(k,String(v)); $("#shareCount").textContent=v;
  }catch(e){}
});

/* ================== Profil client ================== */
function loadProfile(){
  const p = store.get('profile', {name:'', phone:''});
  $("#custName").value = p.name||'';
  $("#custPhone").value = p.phone||'';
  $("#hello").textContent = p.name? `Bienvenue, ${p.name}!` : '';
}
$("#saveProfile").addEventListener('click', ()=>{
  const name=$("#custName").value.trim(); const phone=$("#custPhone").value.trim();
  if(!name || !phone){ toast("Nom et t√©l√©phone obligatoires"); return; }
  store.set('profile', {name, phone});
  $("#hello").textContent = `Bienvenue, ${name}!`;
  toast("Profil enregistr√©");
});
loadProfile();

/* ================== CSV PARSER ================== */
function parseCSV(text){
  const rows=[]; let cur=[]; let cell=''; let inQ=false;
  for(let i=0;i<text.length;i++){
    const ch=text[i], nx=text[i+1];
    if(inQ){
      if(ch==='"' && nx==='"'){ cell+='"'; i++; }
      else if(ch==='"'){ inQ=false; }
      else cell+=ch;
    } else {
      if(ch==='"'){ inQ=true; }
      else if(ch===','){ cur.push(cell); cell=''; }
      else if(ch==='\n' || ch==='\r'){ if(cell!=='' || cur.length){ cur.push(cell); rows.push(cur); cur=[]; cell=''; } }
      else cell+=ch;
    }
  }
  if(cell!=='' || cur.length){ cur.push(cell); rows.push(cur); }
  return rows.filter(r=>r.some(c=>String(c).trim()!==''));
}

/* ================== Donn√©es Produits ================== */
let PRODUCTS = []; // {id, cat, name, imgs[], priceUSD, priceFC, promo, link, notes, stock, score, likes, created}

async function loadProducts(){
  let list=[];
  for(const url of CSV_URLS){
    try{
      const txt = await fetch(url, {cache:'no-store'}).then(r=>r.text());
      const rows = parseCSV(txt);
      const hdr = rows[0].map(h=>h.trim().toLowerCase());
      const idx = {
        cat:   hdr.findIndex(x=>/cat√©g|catego|category/.test(x)),
        name:  hdr.findIndex(x=>/nom|name/.test(x)),
        img:   hdr.findIndex(x=>/lien image|image|img/.test(x)),
        usd:   hdr.findIndex(x=>/prix\s*\$|usd/.test(x)),
        fc:    hdr.findIndex(x=>/franc|fc/.test(x)),
        promo: hdr.findIndex(x=>/promo/.test(x)),
        link:  hdr.findIndex(x=>/^lien$|link/.test(x)),
        notes: hdr.findIndex(x=>/notes?/.test(x)),
        stock: hdr.findIndex(x=>/stock|qty|quant/.test(x))
      };
      for(let i=1;i<rows.length;i++){
        const r=rows[i]; if(!r || !r.length) continue;
        const priceUSD = parseFloat((r[idx.usd]||'').toString().replace(/[^0-9.\-]/g,'')); 
        const priceFC  = parseFloat((r[idx.fc]||'').toString().replace(/[^0-9.\-]/g,''));
        const fc = !isNaN(priceFC) ? priceFC : (!isNaN(priceUSD) ? Math.round(priceUSD*USD_RATE) : 0);
        const imgsRaw = (r[idx.img]||'').trim();
        const imgs = imgsRaw ? imgsRaw.split('|').map(s=>s.trim()).filter(Boolean) : [];
        list.push({
          id: crypto.randomUUID(),
          cat: (r[idx.cat]||'').trim()||'Autres',
          name: (r[idx.name]||'Sans nom').trim(),
          imgs,
          priceUSD: isNaN(priceUSD)? null : priceUSD,
          priceFC: fc,
          promo: (r[idx.promo]||'').trim(),
          link: (r[idx.link]||'').trim(),
          notes: (r[idx.notes]||'').trim(),
          stock: (r[idx.stock]||'').trim(),
          score: 0,
          likes: 0,
          created: Date.now()-Math.floor(Math.random()*1e9)
        });
      }
    }catch(e){ console.error('CSV error', e); toast("Erreur de chargement d'une feuille CSV"); }
  }

  if(!list.length){
    // D√©mo si pas de CSV fourni
    list = [
      {id:crypto.randomUUID(), cat:"V√™tements", name:"Chemise classique homme", imgs:["https://images.unsplash.com/photo-1520974769661-3b1d5b4a3b53?q=80&w=1200&auto=format&fit=crop","https://images.unsplash.com/photo-1520975938310-24e358af9527?q=80&w=1200&auto=format&fit=crop"], priceUSD:15, priceFC:15*USD_RATE, promo:"-10% semaine", link:"", notes:"Tailles S-XL", stock:""},
      {id:crypto.randomUUID(), cat:"T√©l√©phones", name:"Smartphone Android 4G", imgs:["https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&auto=format&fit=crop","https://images.unsplash.com/photo-1510557874967-3a835f1b5b52?q=80&w=1200&auto=format&fit=crop","https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=1200&auto=format&fit=crop"], priceUSD:120, priceFC:120*USD_RATE, promo:"Garantie 6 mois", link:"", notes:"64 Go", stock:""},
      {id:crypto.randomUUID(), cat:"Unit√©s", name:"Unit√©s Airtel Money (RDC)", imgs:["https://images.unsplash.com/photo-1563986768494-4dee2763ff3f?q=80&w=1200&auto=format&fit=crop"], priceUSD:5, priceFC:5*USD_RATE, promo:"Bonus +5%", link:"", notes:"", stock:""},
      {id:crypto.randomUUID(), cat:"Accessoires", name:"√âcouteurs filaires", imgs:["https://images.unsplash.com/photo-1518441902115-f96f9f4889cc?q=80&w=1200&auto=format&fit=crop"], priceUSD:6, priceFC:6*USD_RATE, promo:"2=1 offert", link:"", notes:"", stock:""}
    ];
  }

  // L√©g√®re baisse prix pour attirer (ex: -3%)
  list = list.map(p=>({...p, priceFC: Math.round(p.priceFC*0.97)}));

  PRODUCTS = list.filter(p=>p.name && p.priceFC>0);
  buildFilters(PRODUCTS);
  render(PRODUCTS);
}
loadProducts();

/* ================== RENDER ================== */
const cards = $("#cards"), filtersEl=$("#filters");
function makeCard(p){
  const img = p.imgs?.[0] || "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop";
  const promo = p.promo? `<span class="pill" style="margin-left:auto;background:rgba(245,158,11,.18);border-color:#f59e0b55;color:#fde68a">üéØ ${p.promo}</span>` : "";
  return `
  <article class="card" data-id="${p.id}">
    <img class="thumb" loading="lazy" src="${img}" alt="${p.name}">
    <div class="p">
      <div class="row-b">
        <div class="title">${p.name}</div>
        ${promo}
      </div>
      <div class="muted">${p.cat}${p.notes? ' ‚Ä¢ '+p.notes:''}</div>
      <div class="price">
        <div class="fc">${money(p.priceFC)}</div>
        ${p.priceUSD? `<div class="usd">(~ ${fmt(p.priceUSD)} $)</div>`:''}
      </div>
      <div class="row" style="gap:8px; margin-top:6px">
        <button class="btn brand buyBtn">Acheter</button>
        <button class="btn ghost viewBtn">Voir</button>
      </div>
    </div>
  </article>`;
}
function render(list){ cards.innerHTML = list.map(makeCard).join(''); bindCardEvents(); }
function buildFilters(products){
  const cats = Array.from(new Set(products.map(p=>p.cat))).filter(Boolean);
  filtersEl.innerHTML = ['_all', ...cats].map(c=>`<span class="chip${c==='_all'? ' active':''}" data-cat="${c}">${c==='_all'? 'Tout':c}</span>`).join('');
  filtersEl.querySelectorAll('.chip').forEach(el=>{
    el.addEventListener('click',()=>{
      filtersEl.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
      el.classList.add('active');
      applySearchSort();
    });
  });
}

/* ================== Recherche / Tri ================== */
$("#q").addEventListener('input', applySearchSort);
$("#sort").addEventListener('change', applySearchSort);
function applySearchSort(){
  const q = $("#q").value.trim().toLowerCase();
  const catAct = (filtersEl.querySelector('.chip.active')?.getAttribute('data-cat')) || '_all';
  let list=PRODUCTS.filter(p=> (catAct==='_all' || p.cat===catAct) && (p.name.toLowerCase().includes(q) || p.notes?.toLowerCase().includes(q)));
  const s = $("#sort").value;
  if(s==='priceAsc') list.sort((a,b)=>a.priceFC-b.priceFC);
  if(s==='priceDesc') list.sort((a,b)=>b.priceFC-a.priceFC);
  if(s==='pop') list.sort((a,b)=> (b.score||0)-(a.score||0) );
  if(s==='new') list.sort((a,b)=> (b.created||0)-(a.created||0) );
  render(list);
}

/* ================== Modals (Produit + Paiement) ================== */
const pm = $("#productModal"), payM = $("#payModal");
$("#pmClose").onclick=()=>pm.classList.remove('show');
$("#payClose").onclick=()=>payM.classList.remove('show');
$("#payCancel").onclick=()=>payM.classList.remove('show');

let CURRENT = null; // produit courant
function bindCardEvents(){
  $$(".buyBtn").forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const id = e.target.closest('.card').dataset.id;
      openProduct(id, true);
    })
  });
  $$(".viewBtn").forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const id = e.target.closest('.card').dataset.id;
      openProduct(id, false);
    })
  });
}
function openProduct(id, goPay=false){
  const p = PRODUCTS.find(x=>x.id===id); if(!p) return;
  CURRENT = p;
  $("#pmTitle").textContent = p.name;
  const imgs = p.imgs?.length? p.imgs : ["https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop"];
  $("#pmBig").src = imgs[0];
  const thumbs = imgs.map((u,i)=>`<img class="timg ${i===0?'active':''}" src="${u}" data-i="${i}">`).join('');
  $("#pmThumbs").innerHTML = thumbs;
  $$(".timg").forEach(t=> t.addEventListener('click', ()=>{
    $$(".timg").forEach(x=>x.classList.remove('active')); t.classList.add('active'); $("#pmBig").src = t.src;
  }));
  $("#pmMeta").textContent = `${p.cat}${p.notes? ' ‚Ä¢ '+p.notes:''}${p.stock? ' ‚Ä¢ Stock:'+p.stock:''}`;
  $("#pmPrice").innerHTML = `<div class="fc">${money(p.priceFC)}</div> ${p.priceUSD? `<div class="usd">(~ ${fmt(p.priceUSD)} $)</div>`:''}`;
  $("#pmQty").value=1;

  // WhatsApp message
  const prof = store.get('profile', {});
  const msg = `Bonjour ${prof?.name || ''}, je suis int√©ress√© par: ${p.name} (${p.cat}). Prix: ${fmt(p.priceFC)} FC. Quantit√©: 1. Mon num√©ro: ${prof?.phone || ''}.`;
  $("#pmWhats").href = `https://wa.me/${WHATSAPP_PHONE_INTL}?text=${encodeURIComponent(msg)}`;

  // Stars + comments
  loadCommentsUI(p.id);

  pm.classList.add('show');

  if(goPay){ setTimeout(()=> $("#pmBuyAirtel").click(), 50); }
}

$("#pmBuyAirtel").addEventListener('click', ()=>{
  if(!CURRENT) return;
  const qty = Math.max(1, parseInt($("#pmQty").value||'1',10));
  const total = CURRENT.priceFC * qty;
  $("#paySummary").innerHTML = `
    <div><strong>Produit:</strong> ${CURRENT.name}</div>
    <div><strong>Quantit√©:</strong> ${qty}</div>
    <div><strong>Total:</strong> ${money(total)}</div>
    <div class="muted" style="margin-top:6px">Envoyez sur <strong>${WHATSAPP_DISPLAY}</strong> (Airtel Money ‚Äî ${AIRTEL_NAME}).</div>`;
  $("#payPin").value='';
  payM.classList.add('show');
});

$("#payConfirm").addEventListener('click', ()=>{
  const pin = $("#payPin").value.trim();
  if(pin !== AIRTEL_PIN_TEST){ toast(i18n[store.get('lang','fr')].wrongPin); return; }
  // succ√®s simul√©
  const orders = store.get('orders', []);
  orders.push({id:CURRENT.id, name:CURRENT.name, amount:CURRENT.priceFC*parseInt($("#pmQty").value||'1',10), ts:Date.now()});
  store.set('orders', orders);
  // boost popularit√©
  CURRENT.score = (CURRENT.score||0) + 1;
  toast(i18n[store.get('lang','fr')].paid);
  payM.classList.remove('show'); pm.classList.remove('show');
});

/* ================== Avis / Notes / Commentaires ================== */
function prodKey(id, type){ return `p_${id}_${type}`; }
function loadCommentsUI(id){
  const starsEl = $("#pmStars"), listEl=$("#pmCommentList"), input=$("#pmComment");
  // stars
  const saved = store.get(prodKey(id,'stars'), 0);
  renderStars(saved);
  starsEl.onclick = (e)=>{
    const x = e.offsetX / e.target.clientWidth; // 0..1
    const note = Math.min(5, Math.max(1, Math.round(x*5)));
    store.set(prodKey(id,'stars'), note);
    renderStars(note);
    toast("Merci pour votre note ‚≠ê");
  };
  function renderStars(n){
    starsEl.innerHTML = "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ".split("").map((s,i)=> `<span style="color:${i<n?'#fbbf24':'#94a3b8'}">${s}</span>`).join("");
  }

  // comments
  function refresh(){
    const arr = store.get(prodKey(id,'comments'), []);
    listEl.innerHTML = arr.slice(-20).reverse().map(c=> `<div class="comment"><strong>${c.who}</strong> ‚Äî <span class="muted">${new Date(c.ts).toLocaleString()}</span><br>${c.txt}</div>`).join("") || `<div class="muted">Pas encore de commentaires.</div>`;
  }
  refresh();
  $("#pmAddComment").onclick = ()=>{
    const txt = input.value.trim(); if(!txt) return;
    const prof = store.get('profile', {name:'Anonyme'});
    const arr = store.get(prodKey(id,'comments'), []);
    arr.push({who: prof.name || "Client", txt, ts: Date.now()}); store.set(prodKey(id,'comments'), arr);
    input.value=''; refresh(); toast("Commentaire publi√©");
  };
}

/* ================== Units Promos ================== */
const UNITS = [
  {network:"Airtel", bonus:"+5%", img:"https://images.unsplash.com/photo-1510557874967-3a835f1b5b52?q=80&w=1200&auto=format&fit=crop", price:1000},
  {network:"Vodacom", bonus:"+3%", img:"https://images.unsplash.com/photo-1551816230-ef5deaed4a56?q=80&w=1200&auto=format&fit=crop", price:1000},
  {network:"Orange", bonus:"+4%", img:"https://images.unsplash.com/photo-1531306728370-e2ebd9d7bb99?q=80&w=1200&auto=format&fit=crop", price:1000},
  {network:"Africell", bonus:"+6%", img:"https://images.unsplash.com/photo-1532879311112-62b7188e2f7f?q=80&w=1200&auto=format&fit=crop", price:1000},
  {network:"MTN", bonus:"+2%", img:"https://images.unsplash.com/photo-1551816231-efe4a5d39b9f?q=80&w=1200&auto=format&fit=crop", price:1000},
];
function renderUnits(){
  $("#units").innerHTML = UNITS.map(u=>`
    <article class="card">
      <img class="thumb" src="${u.img}" alt="${u.network}">
      <div class="p">
        <div class="row-b"><div class="title">${u.network} ‚Äî Unit√©s</div><span class="pill" style="background:rgba(16,185,129,.18);border-color:#34d39988;color:#d1fae5">${u.bonus}</span></div>
        <div class="muted">Recharge rapide ‚Äî meilleurs taux</div>
        <div class="price"><div class="fc">${fmt(u.price)} FC</div></div>
        <div class="row" style="gap:8px; margin-top:6px">
          <a class="btn whatsapp" target="_blank" href="https://wa.me/${WHATSAPP_PHONE_INTL}?text=${encodeURIComponent('Bonjour, je veux des unit√©s '+u.network)}">Acheter sur WhatsApp</a>
          <button class="btn brand" onclick="toast('Passez par le produit ‚ÄúUnit√©s '+u.network+'‚Äù dans le catalogue pour paiement simul√©.')">Payer</button>
        </div>
      </div>
    </article>`).join('');
}
renderUnits();

/* ================== Partage produit depuis modal ================== */
$("#pmShare").addEventListener('click', async ()=>{
  if(!CURRENT) return;
  try{
    await navigator.share({title:CURRENT.name, text:"Regarde cette offre üî•", url:location.href});
    toast("Merci pour le partage !");
  }catch(e){}
});

/* ================== Init divers ================== */
document.getElementById('year').textContent = new Date().getFullYear();
// Langue + th√®me init
applyTheme(store.get('theme', (matchMedia('(prefers-color-scheme: light)').matches?'light':'dark')));
const initLang = store.get('lang','fr'); $("#lang").value=initLang; setLang(initLang);

/* ============== BONUS: tri dynamique au clic badge ‚ÄúTout‚Äù ============== */
filtersEl.addEventListener('dblclick', ()=>{ $("#sort").value='pop'; applySearchSort(); });
</script>
</body>
  </html>
<!-- ===== Acc√®s admin cach√© (3 feuilles de s√©curit√©) ===== -->
<style>
  /* Point secret (invisible par d√©faut) */
  #secret-dot {
    position: fixed;
    bottom: 12px;
    right: 12px;
    width: 8px;
    height: 8px;
    background: #cbd5e1; /* gris discret */
    border-radius: 50%;
    opacity: 0;
    pointer-events: none;
    transition: opacity .25s ease, transform .2s ease;
    z-index: 9999;
  }
  #secret-dot.show {
    opacity: .35;
    pointer-events: all;
    cursor: pointer;
  }
  #secret-dot:hover { opacity: 1; transform: scale(1.15); }

  /* Modal ultra-compact pour PIN + Code du jour */
  #admin-modal {
    position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
    background: rgba(0,0,0,.55); z-index: 10000;
  }
  #admin-modal.show { display: flex; }
  #admin-sheet {
    width: min(92vw, 360px);
    background: var(--card, #111827);
    color: var(--text, #e5e7eb);
    border: 1px solid var(--bd, rgba(148,163,184,.2));
    border-radius: 14px; padding: 14px;
    box-shadow: 0 20px 60px rgba(0,0,0,.35);
  }
  #admin-sheet h3 { margin: 0 0 6px; font-size: 1rem; font-weight: 900; }
  #admin-sheet .muted { color: var(--muted, #94a3b8); font-size: .9rem; }
  #admin-sheet .in { width: 100%; margin-top: 8px; padding: 10px 12px; border-radius: 10px;
                     border: 1px solid var(--bd, rgba(148,163,184,.2)); background: var(--card, #111827);
                     color: var(--text, #e5e7eb); }
  #admin-sheet .row { display: flex; gap: 8px; margin-top: 10px; }
  #admin-sheet .btn {
    flex: 1 1 auto; padding: 10px 12px; border-radius: 10px; border: 1px solid transparent; font-weight: 800;
    background: linear-gradient(135deg, var(--brand, #10b981), var(--info, #3b82f6)); color: #fff; cursor: pointer;
  }
  #admin-sheet .btn.ghost {
    background: transparent; border: 1px solid var(--bd, rgba(148,163,184,.2)); color: var(--text, #e5e7eb);
  }
  #admin-err { margin-top: 8px; color: #fca5a5; font-weight: 700; min-height: 1.2em; }
  #admin-hint { margin-top: 4px; color: var(--muted, #94a3b8); font-size: .85rem; }
</style>

<!-- Point secret (devient visible apr√®s geste) -->
<span id="secret-dot" aria-hidden="true" title=" "></span>

<!-- Modal admin -->
<div id="admin-modal" role="dialog" aria-modal="true" aria-labelledby="admin-title">
  <div id="admin-sheet">
    <h3 id="admin-title">Espace Admin</h3>
    <div class="muted">Entrez votre <strong>PIN</strong> et le <strong>code du jour</strong>.</div>
    <input id="admin-pin" class="in" type="password" inputmode="numeric" autocomplete="off" placeholder="PIN admin" maxlength="12" />
    <input id="admin-otp" class="in" type="password" inputmode="numeric" autocomplete="one-time-code" placeholder="Code du jour (4 chiffres)" maxlength="4" />
    <div id="admin-err"></div>
    <div id="admin-hint"></div>
    <div class="row">
      <button id="admin-ok" class="btn">Valider</button>
      <button id="admin-cancel" class="btn ghost">Annuler</button>
    </div>
  </div>
</div>

<script>
/* ========= PARAMS ADMIN (modifie ici si besoin) ========= */
const ADMIN_PIN_B64 = "Njk5NjY5ODg3Nw==";  // "6996698877" encod√© Base64
const DAILY_SEED = 877;                      // graine pour code du jour
const MAX_TRIES = 3;                         // tentatives avant verrouillage
const LOCK_MINUTES = 10;                     // dur√©e de lock en minutes
const ADMIN_TARGET = "admin.html";           // page de destination

/* ========= Raccourcis utiles ========= */
const el = s => document.querySelector(s);
function now(){ return Date.now(); }
function pad4(n){ return String(n).padStart(4, "0"); }
function yyyymmdd(d=new Date()){
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return Number(`${y}${m}${day}`);
}

/* ========= Feuille 1 : gestes secrets pour afficher le point ========= */
const dot = el("#secret-dot");
let konami = [38,38,40,40,37,39,37,39,66,65]; // ‚Üë ‚Üë ‚Üì ‚Üì ‚Üê ‚Üí ‚Üê ‚Üí B A
let idx = 0;
let tapCount = 0, tapTimer = null, dotKeyCount = 0, dotKeyTimer = null;

// 1) KONAMI
window.addEventListener("keydown", (e)=>{
  if(e.keyCode === konami[idx]){ idx++; if(idx === konami.length){ revealDot(); idx = 0; } }
  else { idx = 0; }

  // 3) triple point "."
  if(e.key === "."){
    dotKeyCount++;
    clearTimeout(dotKeyTimer);
    dotKeyTimer = setTimeout(()=>{ dotKeyCount = 0; }, 1200);
    if(dotKeyCount >= 3){ revealDot(); dotKeyCount = 0; }
  }
});

// 2) 7 taps sur le logo "UR" (ou sur .logo)
const logoEl = document.querySelector(".logo");
if(logoEl){
  logoEl.addEventListener("click", ()=>{
    tapCount++;
    clearTimeout(tapTimer);
    tapTimer = setTimeout(()=>{ tapCount = 0; }, 1500);
    if(tapCount >= 7){ revealDot(); tapCount = 0; }
  });
}

function revealDot(){
  dot.classList.add("show");
}

/* ========= Feuille 2 + 3 : PIN + Code du jour (avec anti-brute force) ========= */
const modal = el("#admin-modal");
const pinInput = el("#admin-pin");
const otpInput = el("#admin-otp");
const errBox = el("#admin-err");
const hintBox = el("#admin-hint");

const LOCK_KEY = "adm_lock_v1"; // {tries, until}
const OK_FLAG = "admin_ok";     // "1" si connect√© pour cette session

function getLock(){
  try{ return JSON.parse(localStorage.getItem(LOCK_KEY)) || {tries:0, until:0}; }
  catch(e){ return {tries:0, until:0}; }
}
function setLock(obj){ localStorage.setItem(LOCK_KEY, JSON.stringify(obj)); }

function lockedMsg(until){
  const ms = until - now();
  const min = Math.ceil(ms/60000);
  return `Verrouill√©. R√©essayez dans ~${min} min.`;
}

function showModal(){
  const lk = getLock();
  errBox.textContent = "";
  hintBox.textContent = "";
  if(lk.until && lk.until > now()){
    errBox.textContent = lockedMsg(lk.until);
  }
  pinInput.value = ""; otpInput.value = "";
  modal.classList.add("show");
  setTimeout(()=> pinInput.focus(), 50);
}
function hideModal(){ modal.classList.remove("show"); }

function expectDailyCode(dateObj=new Date()){
  const n = yyyymmdd(dateObj);
  const raw = (n * 7 + DAILY_SEED) % 10000;
  return pad4(raw);
}

function b64(s){ try{ return atob(s); }catch(e){ return ""; } }

function checkPin(pin){
  // l√©g√®re obfuscation : comparaison avec BLURP + reverse + b64 (simple)
  const secret = b64(ADMIN_PIN_B64); // "6996698877"
  return String(pin) === String(secret);
}

function tryLogin(){
  const lk = getLock();
  if(lk.until && lk.until > now()){
    errBox.textContent = lockedMsg(lk.until);
    return;
  }

  const pin = pinInput.value.trim();
  const otp = otpInput.value.trim();

  // validations basiques
  if(!pin || !otp){ errBox.textContent = "Champs manquants."; return; }
  if(!/^\d{1,12}$/.test(pin)){ errBox.textContent = "PIN invalide."; return; }
  if(!/^\d{4}$/.test(otp)){ errBox.textContent = "Code du jour = 4 chiffres."; return; }

  const okPin = checkPin(pin);
  const okOtp = (otp === expectDailyCode());

  if(okPin && okOtp){
    // reset lock, set session token
    setLock({tries:0, until:0});
    sessionStorage.setItem(OK_FLAG, "1");
    // discr√®te redirection
    window.location.href = ADMIN_TARGET;
    return;
  }

  // erreur ‚Üí incr√©menter tentatives
  lk.tries = (lk.tries || 0) + 1;
  if(lk.tries >= MAX_TRIES){
    lk.until = now() + LOCK_MINUTES*60000;
    lk.tries = 0;
    setLock(lk);
    errBox.textContent = lockedMsg(lk.until);
  }else{
    setLock(lk);
    // message d‚Äôerreur g√©n√©rique (ne pas r√©v√©ler laquelle des 2 a rat√©)
    errBox.textContent = `Code incorrect. Tentatives restantes : ${MAX_TRIES - lk.tries}`;
    // petite ‚Äúaide‚Äù facultative : montrer si la date du device est bonne
    const today = yyyymmdd();
    hintBox.textContent = `Astuce : assurez-vous que la date du t√©l√©phone est correcte (${today}).`;
  }
}

/* === Ouverture / fermeture === */
dot.addEventListener("click", showModal);
el("#admin-cancel").addEventListener("click", hideModal);
el("#admin-ok").addEventListener("click", tryLogin);
// fermeture via ESC
window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") hideModal(); });
</script>
<!-- ===== Fin acc√®s admin cach√© ===== -->
