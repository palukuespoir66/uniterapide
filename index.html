<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Unit√© Rapide ‚Äî Boutique</title>
<meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data:; img-src 'self' https: data:; style-src 'self' 'unsafe-inline' https:; script-src 'self' 'unsafe-inline' https:; connect-src 'self' https:;" />
<style>
  :root{
    --bg1:#0f172a; --bg2:#1e293b; --brand:#10b981; --accent:#f59e0b; --danger:#ef4444; --info:#3b82f6;
    --text:#e5e7eb; --muted:#94a3b8; --card:#111827cc; --shadow:0 10px 30px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif;background: radial-gradient(1200px 800px at 10% 10%, #0b1225 0%, #0f172a 40%, #0a0f1f 100%);overflow-x:hidden}
  .bg-anim{position:fixed;inset:-20vmax;z-index:-1;filter:blur(80px) saturate(130%);opacity:.45;background:conic-gradient(from 180deg,#00c2ff,#7c3aed,#10b981,#f59e0b,#00c2ff);animation:spin 28s linear infinite}
  @keyframes spin{to{transform:rotate(1turn)}}
  header{position:sticky;top:0;z-index:50;backdrop-filter:saturate(140%) blur(8px);background:linear-gradient(180deg,rgba(2,6,23,.85),rgba(2,6,23,.55));border-bottom:1px solid rgba(148,163,184,.15)}
  .wrap{max-width:1150px;margin:0 auto;padding:16px 20px}
  .row{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
  .logo{width:38px;height:38px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--info));display:grid;place-items:center;box-shadow:var(--shadow);font-weight:900;color:#fff}
  .promo{background:linear-gradient(90deg,rgba(16,185,129,.15),rgba(59,130,246,.15));border:1px solid rgba(16,185,129,.25);color:#d1fae5;padding:10px 14px;border-radius:12px;font-weight:600;display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .badges{display:flex;gap:10px;flex-wrap:wrap}
  .badge{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));border:1px solid rgba(148,163,184,.18);padding:8px 12px;border-radius:999px;font-weight:600;display:flex;align-items:center;gap:8px;color:#e2e8f0}
  main{max-width:1150px;margin:24px auto;padding:0 20px 80px}
  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px}
  .card{background:linear-gradient(180deg,rgba(17,24,39,.85),rgba(17,24,39,.65));border:1px solid rgba(148,163,184,.18);border-radius:18px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column;min-height:100%}
  .card .thumb{width:100%;height:180px;object-fit:cover;background:#0b1020}
  .card .p{padding:12px 14px}
  .title{font-weight:800;font-size:1.05rem}
  .muted{color:var(--muted);font-size:.92rem}
  .price{display:flex;align-items:center;gap:10px;margin-top:6px}
  .price .fc{font-weight:900;font-size:1.15rem;color:#fff}
  .price .old{color:#fca5a5;text-decoration:line-through;font-weight:700}
  .price .usd{color:#93c5fd;font-weight:700}
  .cta{margin-top:10px;display:flex;gap:8px}
  .btn{flex:1;display:inline-flex;justify-content:center;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;border:1px solid transparent;cursor:pointer;font-weight:800}
  .btn.whatsapp{background:#25D36622;border-color:#25D36655;color:#c3f9d7}
  .btn.secondary{background:rgba(255,255,255,.06);border-color:rgba(148,163,184,.18);color:#e2e8f0}
  .btn:hover{transform:translateY(-1px)}
  .stats{display:flex;gap:12px;flex-wrap:wrap;margin:18px 0}
  .stat{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.02));border:1px solid rgba(148,163,184,.18);padding:10px 14px;border-radius:14px;font-weight:700}
  .filters{display:flex;gap:8px;flex-wrap:wrap;margin:14px 0 18px}
  .chip{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.06);border:1px solid rgba(148,163,184,.18);cursor:pointer;font-weight:700}
  .chip.active{background:linear-gradient(90deg,rgba(16,185,129,.25),rgba(59,130,246,.25));border-color:#34d39977}
  .float{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:10px;z-index:60}
  .float a{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;text-decoration:none;font-weight:800;box-shadow:var(--shadow)}
  .float .w{background:#25D366;color:#06250f}.float .t{background:#229ED9;color:#041e2a}
  footer{max-width:1150px;margin:40px auto;padding:0 20px 60px;color:#cbd5e1}
  .pay{display:flex;gap:10px;flex-wrap:wrap}
  .pill{background:rgba(255,255,255,.07);border:1px solid rgba(148,163,184,.18);padding:8px 12px;border-radius:999px;font-weight:700}
  details{background:rgba(255,255,255,.05);border:1px solid rgba(148,163,184,.18);padding:12px;border-radius:14px}
  details summary{cursor:pointer;font-weight:900}
  /* Modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;padding:20px;z-index:80}
  .modal.show{display:flex}
  .box{max-width:520px;width:100%;background:rgba(2,6,23,.95);border:1px solid rgba(148,163,184,.2);border-radius:16px;box-shadow:var(--shadow);padding:16px}
  .box h3{margin:6px 0 10px}
  .radio{display:flex;gap:8px;flex-wrap:wrap}
  .radio .chip{user-select:none}
  .gallery{display:flex;gap:6px;margin-top:10px}
  .gallery img{width:56px;height:56px;border-radius:10px;object-fit:cover;border:1px solid rgba(148,163,184,.18);cursor:pointer}
  .big{width:100%;max-height:60vh;object-fit:contain;background:#0b1020;border-radius:12px}
  .comment{display:flex;gap:8px;margin-top:8px}
  .comment input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(148,163,184,.25);background:rgba(255,255,255,.06);color:#e2e8f0}
</style>
</head>
<body>
<div class="bg-anim"></div>

<header>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <div class="brand">
        <div class="logo">UR</div>
        <div>
          <div style="font-size:1.05rem">Unit√© Rapide</div>
          <div class="muted" style="font-size:.85rem">Unit√©s ‚Ä¢ T√©l√©phones ‚Ä¢ V√™tements ‚Ä¢ Accessoires</div>
        </div>
      </div>
      <div class="badges">
        <div class="badge">üîí Paiement s√©curis√©</div>
        <div class="badge">üöö Livraison rapide</div>
        <div class="badge">‚≠ê Qualit√© garantie</div>
        <div class="badge">üïò Disponible 24/7</div>
        <div class="badge" id="visitsBadge">üëÅÔ∏è Visites : ‚Ä¶</div>
      </div>
    </div>
    <div class="promo" style="margin-top:12px">
      <div>üî• <strong>Promos</strong> cette semaine ‚Äî meilleurs prix garantis.</div>
      <div class="muted">WhatsApp : <strong>+243 990 564 877</strong> ‚Ä¢ Telegram : <strong>@cphkkk66</strong></div>
    </div>
  </div>
</header>

<main class="wrap">
  <section class="stats">
    <div class="stat">üëÅÔ∏è Vues (ce navigateur) : <span id="viewsLocal">0</span></div>
    <div class="stat">‚ù§Ô∏è J'aime : <span id="likesCount">0</span> <button id="likeBtn" class="chip" style="margin-left:8px">+ J'aime</button></div>
    <div class="stat">üîÅ Partages : <span id="shareCount">0</span> <button id="shareBtn" class="chip" style="margin-left:8px">Partager</button></div>
    <div class="stat">üõí Commandes : <span id="ordersCount">0</span></div>
  </section>

  <section>
    <h2>Catalogue</h2>
    <div class="filters" id="filters"></div>
    <div class="cards" id="cards">Chargement‚Ä¶</div>
  </section>

  <section style="margin-top:28px">
    <h2>Contact</h2>
    <div class="row">
      <a class="btn whatsapp" href="https://wa.me/243990564877" target="_blank">üì± WhatsApp</a>
      <a class="btn secondary" href="https://t.me/cphkkk66" target="_blank">üí¨ Telegram</a>
    </div>
  </section>

  <section style="margin-top:28px">
    <h2>Modes de paiement</h2>
    <div class="pay">
      <span class="pill">üí≥ Airtel Money ‚Äî <strong>Mugisho St√©phane</strong> ‚Äî <strong>+243 990 564 877</strong></span>
      <span class="pill">üì≤ M-Pesa (Vodacom)</span>
      <span class="pill">üü† Orange Money</span>
      <span class="pill">üü£ Afrimoney (Africell)</span>
      <span class="pill">üü° MoMo (MTN)</span>
    </div>
  </section>

  <section style="margin-top:28px">
    <details>
      <summary>üîß Param√®tres & S√©curit√© (infos client)</summary>
      <ul>
        <li>Affichage public = <strong>produits + prix</strong> uniquement.</li>
        <li>Compteurs globaux: vues, j‚Äôaime, partages, commandes (CountAPI).</li>
        <li>Vos paiements passent par l‚Äôapp mobile de votre op√©rateur (USSD non d√©clenchable par le web pour s√©curit√©).</li>
      </ul>
    </details>
  </section>
</main>

<div class="float">
  <a class="w" href="https://wa.me/243990564877" target="_blank">üì± WhatsApp</a>
  <a class="t" href="https://t.me/cphkkk66" target="_blank">üí¨ Telegram</a>
</div>

<footer class="wrap">
  <hr style="border-color:rgba(148,163,184,.2); border-style:solid; border-width:1px 0 0; margin-bottom:16px">
  <div>¬© <span id="year"></span> Unit√© Rapide ‚Äî RDC. Tous droits r√©serv√©s.</div>
</footer>

<!-- ===== Modals ===== -->
<div id="galleryModal" class="modal" aria-hidden="true">
  <div class="box">
    <div class="row" style="justify-content:space-between">
      <h3 id="galTitle">Photos</h3>
      <button class="chip" onclick="closeModal('galleryModal')">Fermer</button>
    </div>
    <img id="galBig" class="big" src="" alt=""/>
    <div id="galThumbs" class="gallery"></div>
  </div>
</div>

<div id="payModal" class="modal" aria-hidden="true">
  <div class="box">
    <div class="row" style="justify-content:space-between">
      <h3 id="payTitle">Paiement</h3>
      <button class="chip" onclick="closeModal('payModal')">Fermer</button>
    </div>
    <div id="payInfo" class="muted" style="margin-bottom:10px"></div>
    <div class="radio" id="payMethods">
      <span class="chip active" data-method="airtel">Airtel Money</span>
      <span class="chip" data-method="mpesa">M-Pesa</span>
      <span class="chip" data-method="orange">Orange Money</span>
      <span class="chip" data-method="afri">Afrimoney</span>
      <span class="chip" data-method="mtn">MoMo</span>
    </div>
    <div id="payPane" style="margin-top:12px"></div>
  </div>
</div>

<script>
/* ====== CONFIG ====== */
const SHEETS_PUBHTML = [
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRNgEaiSzpwmHuoj1bfIFzi9A34beLlxoqz8_ocD5hvb7I2T-4GRcamMbFRCKvw5-lKivYqo3Kpg0Ti/pubhtml?gid=0&single=true",
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vRNgEaiSzpwmHuoj1bfIFzi9A34beLlxoqz8_ocD5hvb7I2T-4GRcamMbFRCKvw5-lKivYqo3Kpg0Ti/pubhtml?gid=2097070430&single=true",
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ7yaRVA16yeVYrB9YAGs_ckiodiHqMns2igOT2ozVM92EXoBOJpCoxZzZ3NLxmHY1G_KqvYKZfvjTS/pubhtml?gid=0&single=true"
];
// Optionnel: lien CSV direct si tu en as un (prioritaire sur pubhtml)
const SHEET_CSV_URL = ""; // ex: https://docs.google.com/spreadsheets/d/ID/export?format=csv
const DISCOUNT_PERCENT = 10; // remise auto pour attirer l‚Äôattention
const RATE_FC = 2800;
const WHATSAPP_NUM = "243990564877";
const SELLER_NAME = "Mugisho St√©phane";
const AIRTEL_NUM = "+243990564877";
const COUNT_NS = "uniterapide_global_v3";

/* ====== Compteurs globaux (CountAPI) + fallback ====== */
(async function initCounters(){
  const badge = document.getElementById('visitsBadge');
  try{
    const j = await fetch(`https://api.countapi.xyz/hit/${COUNT_NS}/visits`).then(r=>r.json());
    badge.textContent = `üëÅÔ∏è Visites : ${Number(j.value||0).toLocaleString('fr-FR')}`;
  }catch{
    const k='ur_visits_fallback', v=(parseInt(localStorage.getItem(k)||'0',10)+1);
    localStorage.setItem(k,String(v));
    badge.textContent = `üëÅÔ∏è Visites : ${v.toLocaleString('fr-FR')}*`;
  }
})();
const localKeyViews='ur_views'; const v=parseInt(localStorage.getItem(localKeyViews)||'0',10)+1;
localStorage.setItem(localKeyViews,String(v));
document.getElementById('viewsLocal').textContent=v.toLocaleString('fr-FR');

(async function likesShares(){
  const likeKey='ur_like'; const likeBtn=document.getElementById('likeBtn'); const likesCount=document.getElementById('likesCount');
  const shareBtn=document.getElementById('shareBtn'); const shareCount=document.getElementById('shareCount');
  let liked=localStorage.getItem(likeKey)==='1';
  try{
    const j=await fetch(`https://api.countapi.xyz/get/${COUNT_NS}/likes`).then(r=>r.json()).catch(()=>({value:0}));
    likesCount.textContent=(j.value||0)+(liked?1:0);
  }catch{likesCount.textContent=liked?1:0}
  if(liked){ likeBtn.textContent='‚ù§Ô∏è Merci'; likeBtn.disabled=true; }
  likeBtn.addEventListener('click', async ()=>{
    if(liked) return; liked=true; localStorage.setItem(likeKey,'1'); likeBtn.textContent='‚ù§Ô∏è Merci'; likeBtn.disabled=true;
    try{ const j=await fetch(`https://api.countapi.xyz/hit/${COUNT_NS}/likes`).then(r=>r.json()); likesCount.textContent=j.value; }catch{}
  });
  try{
    const j=await fetch(`https://api.countapi.xyz/get/${COUNT_NS}/shares`).then(r=>r.json()).catch(()=>({value:0}));
    shareCount.textContent=j.value||0;
  }catch{}
  shareBtn.addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(location.href);
      alert("Lien copi√© ! Merci pour le partage üôè");
    }catch{}
    try{ const j=await fetch(`https://api.countapi.xyz/hit/${COUNT_NS}/shares`).then(r=>r.json()); shareCount.textContent=j.value; }catch{}
  });
})();

/* ====== Commentaires (local pour l‚Äôinstant) ====== */
const commentsKey='ur_comments';
function addComment(text){ const arr=JSON.parse(localStorage.getItem(commentsKey)||'[]'); arr.push({t:Date.now(),text}); localStorage.setItem(commentsKey,JSON.stringify(arr)); renderComments(); }
function renderComments(){
  let list=JSON.parse(localStorage.getItem(commentsKey)||'[]'); list=list.slice(-10).reverse();
  if(!document.getElementById('comments')) {
    const wrap=document.createElement('section'); wrap.innerHTML=`<h2>üí¨ Avis r√©cents</h2><div id="comments"></div><div class="comment"><input id="cmt" placeholder="Donne ton avis (public)..." /><button class="chip" id="cmtBtn">Publier</button></div>`;
    document.querySelector('main').appendChild(wrap);
    document.getElementById('cmtBtn').onclick=()=>{ const v=document.getElementById('cmt').value.trim(); if(v){ addComment(v); document.getElementById('cmt').value=''; } };
  }
  document.getElementById('comments').innerHTML=list.map(x=>`<div class="pill" style="display:block;margin:6px 0">${new Date(x.t).toLocaleString('fr-FR')} ‚Äî ${x.text}</div>`).join('');
}
renderComments();

/* ====== Sheets loader (CSV ou pubhtml table) ====== */
async function loadCSV(url){
  const text=await fetch(url,{cache:'no-store'}).then(r=>r.text());
  const rows=[];let cur=[];let cell='';let inQ=false;for(let i=0;i<text.length;i++){
    const ch=text[i],nx=text[i+1];
    if(inQ){ if(ch==='"'&&nx==='"'){cell+='"';i++;} else if(ch==='"'){inQ=false;} else cell+=ch; }
    else { if(ch==='"'){inQ=true;} else if(ch===','){cur.push(cell);cell='';} else if(ch==='\n' || ch==='\r'){ if(cell!==''||cur.length){cur.push(cell);rows.push(cur);cur=[];cell='';} } else cell+=ch; }
  }
  if(cell!==''||cur.length){cur.push(cell);rows.push(cur)}
  return rows.filter(r=>r.some(c=>String(c).trim()!==''));
}
async function loadPubHtml(url){
  const html=await fetch(url,{cache:'no-store'}).then(r=>r.text());
  const doc=new DOMParser().parseFromString(html,'text/html');
  const table=doc.querySelector('table'); if(!table) return [];
  const rows=[...table.querySelectorAll('tr')].map(tr=>[...tr.children].map(td=>td.textContent.trim()));
  return rows;
}
function headerIndex(hdr,name){ name=name.toLowerCase(); return hdr.findIndex(x=>x.trim().toLowerCase()===name); }

async function fetchProducts(){
  let rows=[];
  if(SHEET_CSV_URL){
    try{ rows=await loadCSV(SHEET_CSV_URL); }catch(e){ console.warn('CSV fail',e); }
  }
  if(!rows.length){
    for(const u of SHEETS_PUBHTML){
      try{
        const r=await loadPubHtml(u);
        if(r.length) rows=rows.concat(r);
      }catch(e){ console.warn('PUBHTML fail',e); }
    }
  }
  if(!rows.length) return [];

  const hdr=rows[0].map(x=>x.trim());
  const idx={
    cat: headerIndex(hdr,'cat√©gorie')>-1? headerIndex(hdr,'cat√©gorie') : 0,
    name: headerIndex(hdr,'nom du produit')>-1? headerIndex(hdr,'nom du produit') : 1,
    img1: headerIndex(hdr,'lien image')>-1? headerIndex(hdr,'lien image') : (headerIndex(hdr,'image 1')),
    img2: headerIndex(hdr,'image 2'),
    img3: headerIndex(hdr,'image 3'),
    img4: headerIndex(hdr,'image 4'),
    img5: headerIndex(hdr,'image 5'),
    usd: headerIndex(hdr,'prix $'),
    fc: headerIndex(hdr,'franc (total)'),
    promo: headerIndex(hdr,'promo'),
    link: headerIndex(hdr,'lien'),
    notes: headerIndex(hdr,'notes'),
    stock: headerIndex(hdr,'stock')
  };

  const prods=[];
  for(let i=1;i<rows.length;i++){
    const r=rows[i]; if(!r || !r.length) continue;
    const g = (i)=>{
      if(i==null || i<0) return ''; return (r[i]||'').toString().trim();
    };
    const priceUSD=parseFloat(g(idx.usd).replace(/[^0-9.\-]/g,'')); const priceFC=parseFloat(g(idx.fc).replace(/[^0-9.\-]/g,''));
    const fc = !isNaN(priceFC) ? priceFC : (!isNaN(priceUSD) ? Math.round(priceUSD*RATE_FC) : 0);
    const imgs = [g(idx.img1),g(idx.img2),g(idx.img3),g(idx.img4),g(idx.img5)].filter(x=>x&&x.startsWith('http'));
    prods.push({
      cat: g(idx.cat)||'Autres',
      name: g(idx.name)||'Sans nom',
      imgs: imgs.length? imgs : ["https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop"],
      priceUSD: isNaN(priceUSD)? null : priceUSD,
      priceFC: fc,
      promo: g(idx.promo)||'',
      link: g(idx.link)||'',
      notes: g(idx.notes)||'',
      stock: g(idx.stock)||'',
    });
  }
  return prods.filter(p=>p.name && p.priceFC>0);
}

/* ====== Render ====== */
const filtersEl=document.getElementById('filters');
const cards=document.getElementById('cards');

function money(n){ try{return Number(n).toLocaleString('fr-FR')}catch(e){return n} }

function openModal(id){ document.getElementById(id).classList.add('show'); document.getElementById(id).setAttribute('aria-hidden','false'); }
function closeModal(id){ document.getElementById(id).classList.remove('show'); document.getElementById(id).setAttribute('aria-hidden','true'); }

function showGallery(p){
  const big=document.getElementById('galBig'); const thumbs=document.getElementById('galThumbs'); const title=document.getElementById('galTitle');
  title.textContent=p.name; big.src=p.imgs[0];
  thumbs.innerHTML=p.imgs.map((u,i)=>`<img src="${u}" alt="img ${i+1}">`).join('');
  [...thumbs.querySelectorAll('img')].forEach((im,idx)=>im.onclick=()=>{ big.src=p.imgs[idx]; });
  openModal('galleryModal');
}

function showPay(p){
  const title=document.getElementById('payTitle'); const info=document.getElementById('payInfo'); const pane=document.getElementById('payPane');
  const discount = Math.round(p.priceFC*(DISCOUNT_PERCENT/100));
  const finalFC = Math.max(0, p.priceFC - discount);
  title.textContent=`Payer ‚Äî ${p.name}`;
  info.innerHTML=`Montant: <strong>${money(finalFC)} FC</strong> ${DISCOUNT_PERCENT? `<span class="pill" style="margin-left:6px">-${DISCOUNT_PERCENT}% promo</span>`:''}`;
  function render(method='airtel'){
    let html='';
    if(method==='airtel'){
      html = `
        <div class="pill" style="display:block;margin-bottom:10px">
          Envoyez exactement <strong>${money(finalFC)} FC</strong> √† <strong>${AIRTEL_NUM}</strong> (Airtel Money ‚Äî ${SELLER_NAME}).
        </div>
        <div class="row">
          <button class="chip" onclick="copyText('${AIRTEL_NUM}')">Copier le num√©ro</button>
          <a class="chip" target="_blank" href="https://wa.me/${WHATSAPP_NUM}?text=${encodeURIComponent('Bonjour, j‚Äôai pay√© '+money(finalFC)+' FC pour: '+p.name)}">Notifier sur WhatsApp</a>
        </div>
        <div class="muted" style="margin-top:8px">
          ‚ö†Ô∏è Pour votre s√©curit√©, entrez votre <strong>code SIM</strong> uniquement dans l‚Äôapplication officielle Airtel. Le site ne vous demandera jamais votre code.
        </div>`;
    } else {
      html = `
        <div class="pill" style="display:block;margin-bottom:10px">
          Veuillez payer <strong>${money(finalFC)} FC</strong> via <strong>${method.toUpperCase()}</strong> puis nous notifier sur WhatsApp.
        </div>
        <a class="chip" target="_blank" href="https://wa.me/${WHATSAPP_NUM}?text=${encodeURIComponent('Bonjour, j‚Äôai pay√© '+money(finalFC)+' FC via '+method.toUpperCase()+' pour: '+p.name)}">Notifier sur WhatsApp</a>`;
    }
    pane.innerHTML=html;
  }
  render('airtel');
  document.querySelectorAll('#payMethods .chip').forEach(ch=>{
    ch.onclick=()=>{ document.querySelectorAll('#payMethods .chip').forEach(x=>x.classList.remove('active')); ch.classList.add('active'); render(ch.dataset.method); };
  });
  openModal('payModal');
}

function makeCard(p){
  const discount = Math.round(p.priceFC*(DISCOUNT_PERCENT/100));
  const finalFC = Math.max(0, p.priceFC - discount);
  const usd = p.priceUSD ? `(~ ${money(p.priceUSD)} $)` : '';
  const promoTag = p.promo ? `<span class="pill" style="margin-left:auto;background:rgba(245,158,11,.18);border-color:#f59e0b55;color:#fde68a">üéØ ${p.promo}</span>` : '';
  return `
  <article class="card">
    <img class="thumb" loading="lazy" src="${p.imgs[0]}" alt="${p.name}" onclick='showGallery(${JSON.stringify(p)})'>
    <div class="p">
      <div class="row" style="justify-content:space-between;align-items:flex-start">
        <div class="title">${p.name}</div>
        ${promoTag}
      </div>
      <div class="muted">${p.cat}${p.notes? ' ‚Ä¢ '+p.notes:''}</div>
      <div class="price">
        ${DISCOUNT_PERCENT? `<div class="old">${money(p.priceFC)} FC</div>`:''}
        <div class="fc">${money(finalFC)} FC</div>
        <div class="usd">${usd}</div>
      </div>
      <div class="cta">
        <button class="btn whatsapp" onclick='orderNow(${JSON.stringify(p)})'>üõí Acheter</button>
        <button class="btn secondary" onclick='showGallery(${JSON.stringify(p)})'>üñºÔ∏è Photos</button>
      </div>
    </div>
  </article>`;
}

function buildFilters(products){
  const cats=Array.from(new Set(products.map(p=>p.cat))).filter(Boolean);
  filtersEl.innerHTML=['_all', ...cats].map(c=>`<span class="chip${c==='_all'?' active':''}" data-cat="${c}">${c==='_all'?'Tout':c}</span>`).join('');
  filtersEl.querySelectorAll('.chip').forEach(el=>{
    el.onclick=()=>{
      filtersEl.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
      el.classList.add('active');
      const cat=el.getAttribute('data-cat');
      renderCards(cat==='_all'? products : products.filter(p=>p.cat===cat));
    }
  });
}

function renderCards(list){ cards.innerHTML=list.map(makeCard).join(''); }

/* ====== Order flow ====== */
async function orderNow(p){
  // incr√©mente commandes + ‚Äúgains estim√©s (FC)‚Äù c√¥t√© compteur global
  try{
    await fetch(`https://api.countapi.xyz/hit/${COUNT_NS}/orders`).then(r=>r.json()).then(j=>{ document.getElementById('ordersCount').textContent=j.value; });
    const discount = Math.round(p.priceFC*(DISCOUNT_PERCENT/100));
    const finalFC = Math.max(0, p.priceFC - discount);
    // cumule gains (en FC) ‚Äî on stocke en entier FC
    await fetch(`https://api.countapi.xyz/update/${COUNT_NS}/revenue?amount=${encodeURIComponent(finalFC)}`).catch(()=>{});
  }catch{}
  showPay(p);
}

/* ====== Boot ====== */
async function boot(){
  document.getElementById('year').textContent=new Date().getFullYear();

  let products=[];
  try{
    products=await fetchProducts();
  }catch(e){
    alert("‚ö†Ô∏è Erreur de chargement des produits. V√©rifie tes liens Google Sheets.");
  }
  if(!products.length){
    // D√©mo fallback
    products = [
      {cat:"V√™tements", name:"Chemise classique homme", imgs:["https://images.unsplash.com/photo-1520974769661-3b1d5b4a3b53?q=80&w=1200&auto=format&fit=crop","https://images.unsplash.com/photo-1516826957135-700dedea698c?q=80&w=1200&auto=format&fit=crop"], priceUSD:15, priceFC:15*RATE_FC, notes:"S-XL", promo:"-10%"},
      {cat:"T√©l√©phones", name:"Smartphone Android 4G", imgs:["https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&auto=format&fit=crop","https://images.unsplash.com/photo-1510557880182-3d4d3cba35a5?q=80&w=1200&auto=format&fit=crop"], priceUSD:120, priceFC:120*RATE_FC, notes:"32Go/3Go", promo:"Garantie 3 mois"},
      {cat:"Unit√©s", name:"Unit√©s Airtel Money (RDC)", imgs:["https://images.unsplash.com/photo-1563986768494-4dee2763ff3f?q=80&w=1200&auto=format&fit=crop"], priceUSD:5, priceFC:5*RATE_FC, notes:"Recharge rapide", promo:""}
    ];
  }
  buildFilters(products);
  renderCards(products);
}
boot();

function copyText(t){ navigator.clipboard.writeText(t).then(()=>alert("Copi√© !")) }
</script>
</body>
                                                                                                                                       </html>
